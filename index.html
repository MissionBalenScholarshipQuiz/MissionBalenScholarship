
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Balen Scholarship - Prep Portal</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone@7.24.7/babel.min.js"></script>
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" rel="stylesheet" />
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=Playfair+Display:wght@700&family=Dancing+Script:wght@600&display=swap" rel="stylesheet">
    <!-- html2canvas for downloads -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        body { font-family: 'Inter', system-ui, sans-serif; background-color: #f8fafc; background-image: radial-gradient(circle at 1px 1px, #e2e8f0 1px, transparent 0); background-size: 20px 20px; }
        .dark body { background-color: #020617; background-image: radial-gradient(circle at 1px 1px, #1e293b 1px, transparent 0); }
        .font-serif { font-family: 'Playfair Display', serif; }
        .font-script { font-family: 'Dancing Script', cursive; letter-spacing: 0.5px; }
        @keyframes gradient-animation { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        .animate-gradient { background-size: 400% 400%; animation: gradient-animation 15s ease infinite; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fadeIn { animation: fadeIn 0.6s ease-out forwards; }
        @keyframes slideInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .animate-slideInUp { animation: slideInUp 0.5s ease-out forwards; }
        @keyframes popIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .animate-popIn { animation: popIn 0.4s ease-out; }
        @keyframes tada { from {transform: scale3d(1, 1, 1);} 10%, 20% {transform: scale3d(.9, .9, .9) rotate3d(0, 0, 1, -3deg);} 30%, 50%, 70%, 90% {transform: scale3d(1.1, 1.1, 1.1) rotate3d(0, 0, 1, 3deg);} 40%, 60%, 80% {transform: scale3d(1.1, 1.1, 1.1) rotate3d(0, 0, 1, -3deg);} to {transform: scale3d(1, 1, 1);} }
        .animate-tada { animation: tada 1s ease-in-out; }
        .glassmorphism { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.2); }
        .dark .glassmorphism { background: rgba(15, 23, 42, 0.2); border-color: rgba(51, 65, 85, 0.5); }
        .gradient-button { background: linear-gradient(45deg, #4f46e5, #9333ea); transition: all .3s ease; }
        .gradient-button:hover:not(:disabled) { transform: translateY(-3px) scale(1.03); box-shadow: 0 10px 25px rgba(79,70,229,.4); }
        .gradient-button:disabled { background: #9ca3af; cursor: not-allowed; }
        .card-hover { transition: transform .3s ease, box-shadow .3s ease; }
        .card-hover:hover { transform: translateY(-8px) scale(1.02); box-shadow: 0 25px 40px -12px rgba(0,0,0,.15); }
        .nav-button.active { background: linear-gradient(45deg, #4338ca, #7e22ce); box-shadow: 0 6px 18px rgba(79,70,229,.45); transform: translateY(-2px); }
        .quiz-progress-bar { height: 12px; border-radius: 6px; background-color: #e5e7eb; overflow: hidden; }
        .dark .quiz-progress-bar { background-color: #374151; }
        .quiz-progress-fill { height: 100%; background: linear-gradient(45deg, #22c55e, #84cc16); border-radius: 6px; transition: width .5s ease-in-out; }
        .overlay { position: fixed; inset: 0; background-color: rgba(0,0,0,.7); display: flex; justify-content: center; align-items: center; z-index: 1000; padding: 1rem; backdrop-filter: blur(4px); animation: fadeIn 0.3s ease; }
        .modal-box { padding: 2rem; border-radius: 1rem; box-shadow: 0 20px 40px rgba(0,0,0,.3); text-align: center; color: #111827; animation: popIn .4s ease-out; max-width: 95%; width: 500px; max-height: 90vh; overflow-y: auto; }
        .dark .modal-box { color: #f3f4f6; }
        .pdf-viewer-modal { background: #111827; padding: 0; border-radius: .75rem; overflow: hidden; width: 95vw; height: 90vh; max-width: 1200px; display: flex; flex-direction: column; position: relative; }
        .pdf-viewer-modal .header { padding: .75rem 1.5rem; background: #262626; display:flex; justify-content: space-between; align-items: center; }
        .pdf-viewer-modal .header h3 { font-weight: bold; color: white; }
        .pdf-viewer-modal .close-button { background: rgba(255,255,255,.2); color: white; border: none; border-radius: 9999px; width: 32px; height: 32px; display: grid; place-items: center; font-size: 1.1rem; cursor: pointer; z-index: 1001; }
        .nav-button-notify::after { content: ''; position: absolute; top: 0.5rem; right: 0.5rem; width: 8px; height: 8px; border-radius: 50%; background-color: #ef4444; border: 1px solid white; }
        @keyframes confetti-fall { 0% { transform: translateY(-100%) rotateZ(0deg); } 100% { transform: translateY(100vh) rotateZ(720deg); } }
        .confetti { position: absolute; width: 10px; height: 10px; opacity: 0.7; animation: confetti-fall 5s linear infinite; }
        /* Styles for fullscreen quiz viewer */
        .fullscreen-quiz-viewer { position: fixed; inset: 0; z-index: 2000; background-color: #111827; display: flex; flex-direction: column; animation: fadeIn 0.3s ease; }
        .fullscreen-quiz-viewer .header { padding: 1rem 1.5rem; background: #1f2937; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #374151; }
        .fullscreen-quiz-viewer .header h3 { font-weight: bold; color: white; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .fullscreen-quiz-viewer iframe { flex-grow: 1; border: none; }
        /* Enhanced PDF Viewer Styles */
        .pdf-annotation-mode { cursor: crosshair; }
        .pdf-annotation-toolbar { position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.7); padding: 10px; border-radius: 8px; z-index: 1002; }
        .pdf-annotation-toolbar button { background: #4f46e5; color: white; border: none; padding: 8px 12px; margin: 2px; border-radius: 4px; cursor: pointer; }
        .pdf-annotation-toolbar button.active { background: #9333ea; }
    </style>
</head>
<body class="bg-gray-100 dark:bg-slate-900 text-gray-800 dark:text-gray-200 transition-colors duration-300">
    <div id="root"></div>

<script type="text/babel">
    const { useState, useEffect, useMemo, Fragment, useCallback, useRef } = React;

    // =================================================================================
    // ===== 1. UPDATED DATA OBJECT =====
    // =================================================================================
    const DATA = {
        whatsAppContactNumber: "9826594548",
        whatsAppGroupLink: "https://chat.whatsapp.com/YOUR_GROUP_LINK", // Add your WhatsApp group link here
        premiumInfoVideoLink: 'https://www.youtube.com/watch?v=dQw4w9WgXcQ', // Placeholder link
        premiumPrice: 199,
        esewaId: "9863997295",
        XP_PER_QUIZ: 10,
        XP_PER_LEVEL: 100,
        XP_PER_BRAIN_BREAK: 5,
        STREAK_UNLOCKS: { 7: 2, 14: 5, 30: 10 },
        validSymbolNumbers: ['S001', 'S002', 'S003', '021052854', '04803820', 'S004', 'S005', '03607811', '4444', '7777', 'S006', 'S007', 'S008', 'S009', 'S010'],
        dailyQuizzes: [
           { day: 1, subject: "Mixed", title: "Mixed Subject Challenge", link: "https://ganeshdahal-hue.github.io/mix/", isPremium: false },
            { day: 2, subject: "Science", title: "Physics Practice Test", link: "https://ganeshdahal-hue.github.io/physis/", isPremium: false },
            { day: 3, subject: "English", title: "Grammar Essentials", link: "https://ganeshdahal-hue.github.io/english/", isPremium: false },
            { day: 4, subject: "GK", title: "World Geography", link: "https://ganeshdahal-hue.github.io/GK/", isPremium: false },
            { day: 5, subject: "Science", title: "Physics Fundamentals", link: "https://ganeshdahal-hue.github.io/physic/", isPremium: false },
            
             { day: 36, subject: "Scholarship", title: "Scholarship Mastery", link: "https://ganeshdahal-hue.github.io/balenscholarships/", isPremium: true }
        ],
      quizzes: {
        "Science": {
            title: "Science Quizzes",
            icon: "fa-solid fa-flask",
            chapters: {
              "Scientific Study": {
  questions: [
    { question: "How many types of variables are there?", options: ["3", "4", "5", "6"], correctAnswer: "4" },
    { question: "The variable that can be controlled while doing the experiment is called:", options: ["Independent", "Controlled", "Dependent", "Constant"], correctAnswer: "Controlled" },
       { question: "Why is the second considered a fundamental unit?", options: ["It is derived from other units", "It is used to measure time independently", "It depends on the meter and kilogram", "It is only used in derived units"], correctAnswer: "It is used to measure time independently" }
  ]
},
"Classification of Living Beings": {
  questions: [
    { question: "Which of the following plants belongs to division Algae?", options: ["Riccia", "Volvox", "Cycas", "Liverworts"], correctAnswer: "Volvox" },
    { question: "Why is Juniper kept in sub-division Gymnosperms?", options: ["It has needle-shaped leaves", "It has naked seeds", "It has chlorophyll", "It has cones instead of fruit"], correctAnswer: "It has naked seeds" },
    { question: "Identify the dicot plant from the following:", options: ["Garlic", "Maize", "Bamboo", "Apple"], correctAnswer: "Apple" },
       { question: "What is the primary function of the nematocysts in Coelenterates?", options: ["Locomotion", "Digestion", "Capturing prey and defense", "Respiration"], correctAnswer: "Capturing prey and defense" }
  ]
},
}
},
        "English": {
            title: "English Quizzes",
            icon: "fa-solid fa-spell-check",
            chapters: {
                "Articles": {
                    questions: [
                        { question: "I saw ___ eagle in the sky.", options: ["a", "an", "the", "no article"], correctAnswer: "an" },
                        { question: "She is ___ best student in the class.", options: ["a", "an", "the", "no article"], correctAnswer: "the" },
                        { question: "He is ___ honest man.", options: ["a", "an", "the", "no article"], correctAnswer: "an" },
                    ]
                },
                "Prepositions": {
                    questions: [
                        { question: "The cat is sitting ___ the table.", options: ["on", "in", "at", "with"], correctAnswer: "on" },
                        { question: "He is afraid ___ dogs.", options: ["of", "from", "with", "by"], correctAnswer: "of" },
                    ]
                },
                "Tenses": {
                    questions: [
                        { question: "She ___ to school every day.", options: ["go", "goes", "is going", "went"], correctAnswer: "goes" },
                        { question: "They ___ playing football now.", options: ["are", "is", "was", "were"], correctAnswer: "are" },
                    ]
                }
            }
        },
        "Maths": {
            title: "Maths Quizzes",
            icon: "fa-solid fa-calculator",
            chapters: {
                "Algebra": {
                    questions: [
                        { question: "What is the value of x if 2x + 3 = 7?", options: ["1", "2", "3", "4"], correctAnswer: "2" },
                        { question: "Factorize xÂ² - 4.", options: ["(x-2)(x-2)", "(x+2)(x+2)", "(x-2)(x+2)", "(x-4)(x+1)"], correctAnswer: "(x-2)(x+2)" },
                    ]
                },
                "Geometry": {
                    questions: [
                        { question: "What is the sum of angles in a triangle?", options: ["90Â°", "180Â°", "270Â°", "360Â°"], correctAnswer: "180Â°" },
                        { question: "What is the area of a circle with radius 'r'?", options: ["Ï€r", "2Ï€r", "Ï€rÂ²", "2Ï€rÂ²"], correctAnswer: "Ï€rÂ²" },
                    ]
                }
            }
        },
        "GK": {
            title: "GK Quizzes",
            icon: "fa-solid fa-globe",
            chapters: {
                "World Capitals": {
                    questions: [
                        { question: "What is the capital of Australia?", options: ["Sydney", "Melbourne", "Canberra", "Perth"], correctAnswer: "Canberra" },
                        { question: "What is the capital of Japan?", options: ["Kyoto", "Osaka", "Tokyo", "Hiroshima"], correctAnswer: "Tokyo" },
                    ]
                },
                "Famous Inventions": {
                    questions: [
                        { question: "Who invented the telephone?", options: ["Thomas Edison", "Alexander Graham Bell", "Isaac Newton", "Albert Einstein"], correctAnswer: "Alexander Graham Bell" },
                        { question: "Who is credited with the invention of the light bulb?", options: ["Nikola Tesla", "Thomas Edison", "Benjamin Franklin", "Marie Curie"], correctAnswer: "Thomas Edison" },
                    ]
                }
            }
        },
      },
            resources: [
            { category: "Premium Materials", items: [
                { title: "Bridge Course Book", link: "https://drive.google.com/file/d/1Q1i4sf6BStnIt4XgZRuLmPk3fL3AHx7x/view?usp=drive_link", tags: ['book', 'core'] },
                  { title: "Balen Entrance qn 2082", link: "https://drive.google.com/file/d/1aACIunJxfDtSeQdAAU-vXhwUMxp78Jky/view?usp=drive_link", tags: ['past-paper', 'balen'] },
                { title: "Daily Updated PDF", link: "https://drive.google.com/drive/folders/1NQFdxJ0uYwOMpVcD-TKFZ4-zB5Xb70Ru?usp=sharing", tags: ['pdf', 'daily'] },
            ]},
            { category: "Free Resources", items: [
                { title: "Daily Updated PDF", link: "https://drive.google.com/drive/folders/1On-EmwuZ6yyRFKixIneRA9ZjLsX_ally?usp=drive_link", tags: ['pdf', 'daily'] },
                { title: "Sample Questions", link: "https://drive.google.com/file/d/1DksWWHY6JQUFzOy2Jv97HPlsgD0WNHVo/view?usp=drive_link", tags: ['mcq', 'mixed'] },
                { title: "SEE Gear Up Book", link: "https://drive.google.com/file/d/1uypKarUcoYgDnD0pISv96-8r9UTKhU6O/view?usp=sharing", tags: ['book', 'core'] },
                { title: "All subject MCQs", link: "https://drive.google.com/file/d/1Aqz8fcIMbHqgoHJZScUchDWV2P3Vv7OA/view?usp=sharing", tags: ['mcq', 'mixed'] },
            ]}
        ],
        videos: [
            { title: "All About Balen Exam", link: "#" },
            { title: "How to Fill Balen Scholarship Form", link: "#" },
            { title: "How to Check SEE Result", link: "#" },
            { title: "Balen Exam Tips", link: "#" },
        ],
        notices: [
            { id: 3, title: "New Video Guide Added just for you", date: "August 2, 2024", content: "We've added a new video guide on exam strategies. <a href='https://www.youtube.com' target='_blank' rel='noopener noreferrer' class='text-blue-500 hover:underline'>Click here to watch!</a>", type: "Update" },
            { id: 2, title: "Weekly Quiz Competition Schedule", date: "July 28, 2024", content: "Our weekly live quiz competition will now be held every Monday, Wednesday, and Saturday at 8:00 PM.", type: "Announcement" },
            { id: 1, title: "Form Submission Deadline Approaching", date: "July 25, 2024", content: "Please remember that the deadline for the official Balen Scholarship form submission is approaching.", type: "Important" },
             { id: 7, title: "Welcome To our Portal", date: "October 2, 2024", content: "Thank You for choosing us <a href='#' class='text-blue-500 hover:underline'>Click for details.</a>", type: "Important", isCompulsory: true },
        ],
        faqs: [ { category: "Eligibility & General", items: [
                        { question: "Who can apply for the scholarship?", answer: "Any student who passed SEE with at least 1.6 GPA from either a community or institutional school in Nepal. Priority is given to community school students, underrepresented groups, and those with financial need." },
                        { question: "Do I need to be from Kathmandu, or can students from other districts apply?", answer: "Yes, students from all over Nepal can apply. However, priority is given to students studying in schools under Kathmandu Metropolitan City." },
                        { question: "Is this exam the same as +2 college admission entrance exams?", answer: "No. This is a separate scholarship entrance exam conducted by Kathmandu Metropolitan City, not a general college admission exam." },
                        { question: "What is the minimum GPA required in SEE to be eligible?", answer: "The minimum eligibility requirement is a GPA of 1.6 or above in the SEE examination." },
                        { question: "Is there any age limit for applying?", answer: "No specific age limit is mentioned. The exam is primarily intended for recent SEE graduates applying for +2 (Science, Management, Humanities, or Law)." },
                    ]},
     
                ],
        competitionResults: {
            date: "August 12, 2024", // **IMPORTANT**: Change this date to trigger new certificates for winners.
            podium: [{ rank: 1, name: "Ganesh Dahal", symbol: "S002", score: "98%", img: "https://raw.githubusercontent.com/ganeshdahal-HUE/practicece/6684a6cfa40eda8be7402689857a23575f0b723a/494645815_122099085086862980_1698079942897814974_n.jpg", medal: 'ðŸ†', color: 'amber' },{ rank: 2, name: "Alex Johnson", symbol: "S003", score: "95%", img: "https://i.pravatar.cc/150?u=alex", medal: 'ðŸ¥ˆ', color: 'slate' },{ rank: 3, name: "John Doe", symbol: "S001", score: "92%", img: "https://i.pravatar.cc/150?u=john", medal: 'ðŸ¥‰', color: 'orange' }],
            table: [{ rank: 4, name: "Player 4", symbol: "S004", score: "88%" },{ rank: 5, name: "Player 5", symbol: "S005", score: "85%" }]
        },
        leaderboardData: [
            { rank: 1, name: "Ganesh Dahal", symbol: "S002", score: 1850, medal: 'ðŸ†' },
            { rank: 2, name: "Alex Johnson", symbol: "S003", score: 1720, medal: 'ðŸ¥ˆ' },
            { rank: 3, name: "John Doe", symbol: "S001", score: 1680, medal: 'ðŸ¥‰' },
            { rank: 4, name: "Player 4", symbol: "S004", score: 1550 },
            { rank: 5, name: "Player 5", symbol: "S005", score: 1490 },
            { rank: 6, name: "Sarah Connor", symbol: "S006", score: 1450 },
            { rank: 7, name: "Mike Ross", symbol: "S007", score: 1380 },
            { rank: 8, name: "Hello", symbol: "021052854", score: 1350 },
            { rank: 9, name: "Jessica Pearson", symbol: "S008", score: 1290 },
            { rank: 10, name: "Harvey Specter", symbol: "S009", score: 1250 }
        ],
        entertainment: {
            brainTeasers: [
                {question: "Which law states that pressure exerted in a confined incompressible fluid is transmitted equally in all directions?", options: ["Archimedes' Principle", "Newton's Law", "Pascal's Law", "Hooke's Law"], correctAnswer: "Pascal's Law"},
                {question: "What is the standard unit of Power?", options: ["Joule", "Watt", "Newton", "Pascal"], correctAnswer: "Watt"},
                {question: "A dynamo is a device which converts:", options: ["Mechanical energy into electrical energy", "Electrical energy into mechanical energy", "Chemical energy into electrical energy", "Solar energy into electrical energy"], correctAnswer: "Mechanical energy into electrical energy"},
                {question: "Who was the first elected Prime Minister of Nepal?", options: ["Tanka Prasad Acharya", "Matrika Prasad Koirala", "Bishweshwar Prasad Koirala", "Kirtinidhi Bista"], correctAnswer: "Bishweshwar Prasad Koirala"}
                
            ],
            motivationalQuotes: [
                { "quote": "The secret of getting ahead is getting started.", "author": "Mark Twain" },
    { "quote": "The only way to do great work is to love what you do.", "author": "Steve Jobs" },
    { "quote": "Believe you can and you're halfway there.", "author": "Theodore Roosevelt" },
       { "quote": "Learning never exhausts the mind.", "author": "Leonardo da Vinci" }
            ],
            riddles: [
                 { "riddle": "I speak without a mouth and hear without ears. I have no body, but I come alive with wind. What am I?", "answers": ["an echo", "echo"] },
    { "riddle": "What has an eye, but cannot see?", "answers": ["a needle", "needle"] },
    { "riddle": "What has keys, but opens no locks? And space, but no room?", "answers": ["a keyboard", "keyboard", "a piano", "piano"] },
       { "riddle": "You see me once in June, twice in November, and not at all in May. What am I?", "answers": ["the letter e", "letter e", "e"] }
            ]
        },
        achievementsList: {
            FIRST_QUIZ: { id: 'FIRST_QUIZ', title: 'First Step', icon: 'fas fa-shoe-prints', description: 'Complete your very first daily quiz.' },
            ALL_QUIZZES: { id: 'ALL_QUIZZES', title: 'Course Complete', icon: 'fas fa-trophy', description: 'Successfully complete all daily quizzes.', hasCertificate: true },
            STREAK_7: { id: 'STREAK_7', title: 'Dedicated Scholar', icon: 'fas fa-fire-alt', description: 'Maintain a 7-day login streak.' },
            STREAK_14: { id: 'STREAK_14', title: 'Habit Builder', icon: 'fas fa-calendar-check', description: 'Maintain a 14-day login streak.' },
            STREAK_30: { id: 'STREAK_30', title: 'Portal Legend', icon: 'fas fa-crown', description: 'Maintain a 30-day login streak.' },
            BRAIN_ACADEMY: { id: 'BRAIN_ACADEMY', title: 'Brain Academy', icon: 'fas fa-brain', description: 'Complete a brain teaser and a riddle in one day.' },
            THREE_WINS: { id: 'THREE_WINS', title: 'Podium Pro', icon: 'fas fa-medal', description: 'Achieve a top 3 position in the quiz competition 3 times.' },
            PREMIUM_USER: { id: 'PREMIUM_USER', title: 'Premium Supporter', icon: 'fas fa-star', description: 'Unlock premium access to support the portal.', hasCertificate: true },
            PDF_READER: { id: 'PDF_READER', title: 'Book Worm', icon: 'fas fa-book-reader', description: 'Read 5 different PDF resources.' }
        },
        // Good Friday Quiz Questions Pool
        goodFridayQuestions: [
            { question: "What is the capital of Nepal?", options: ["Pokhara", "Kathmandu", "Biratnagar", "Lalitpur"], correctAnswer: "Kathmandu" },
            { question: "Which is the highest mountain in the world?", options: ["K2", "Mount Everest", "Kangchenjunga", "Lhotse"], correctAnswer: "Mount Everest" },
            { question: "Who is known as the light of Asia?", options: ["Gautam Buddha", "Mahatma Gandhi", "Swami Vivekananda", "APJ Abdul Kalam"], correctAnswer: "Gautam Buddha" },
            { question: "What is the chemical symbol for Gold?", options: ["Go", "Gd", "Au", "Ag"], correctAnswer: "Au" },
            { question: "Which planet is known as the Red Planet?", options: ["Venus", "Mars", "Jupiter", "Saturn"], correctAnswer: "Mars" },
            { question: "What is the largest ocean on Earth?", options: ["Atlantic Ocean", "Indian Ocean", "Arctic Ocean", "Pacific Ocean"], correctAnswer: "Pacific Ocean" },
            { question: "Who wrote 'Romeo and Juliet'?", options: ["Charles Dickens", "William Shakespeare", "Jane Austen", "Mark Twain"], correctAnswer: "William Shakespeare" },
            { question: "What is the square root of 64?", options: ["6", "7", "8", "9"], correctAnswer: "8" },
            { question: "Which gas do plants absorb from the atmosphere?", options: ["Oxygen", "Carbon Dioxide", "Nitrogen", "Hydrogen"], correctAnswer: "Carbon Dioxide" },
            { question: "What is the hardest natural substance on Earth?", options: ["Gold", "Iron", "Diamond", "Platinum"], correctAnswer: "Diamond" }
        ]
    };
    // =================================================================================
    // ===== HELPER FUNCTIONS & REUSABLE UI COMPONENTS =====
    // =================================================================================
    const getJSONFromLocalStorage = (key, defaultValue) => { try { const item = localStorage.getItem(key); return item ? JSON.parse(item) : defaultValue; } catch (error) { console.error(`Error with localStorage key "${key}":`, error); return defaultValue; } };
    const getIconForResource = (tags) => { if (!tags) return 'fas fa-file-alt'; if (tags.includes('book')) return 'fas fa-book-open'; if (tags.includes('math')) return 'fas fa-calculator'; if (tags.includes('english')) return 'fas fa-spell-check'; if (tags.includes('science')) return 'fas fa-flask'; if (tags.includes('past-paper')) return 'fas fa-history'; if (tags.includes('mcq')) return 'fas fa-list-check'; return 'fas fa-file-alt'; };
    const generatePremiumCode = (name) => { if (!name || name.length < 3) return null; const getPrecedingAndSuccessiveChars = (char) => { if (!char || typeof char !== 'string' || char.length !== 1) return { preceding: '', successive: '' }; const lowerChar = char.toLowerCase(); const code = lowerChar.charCodeAt(0); let preceding = '', successive = ''; if (code >= 97 && code <= 122) { preceding = String.fromCharCode(code === 97 ? 122 : code - 1); successive = String.fromCharCode(code === 122 ? 97 : code + 1); } return { preceding, successive }; }; const third = name.charAt(2).toLowerCase(); const { preceding, successive } = getPrecedingAndSuccessiveChars(third); return `${name}@1234${preceding}${successive}`; };
    const DarkModeToggle = () => { const [darkMode, setDarkMode] = useState(false); useEffect(() => { const isDark = localStorage.getItem('darkMode') === 'true'; setDarkMode(isDark); document.documentElement.classList.toggle('dark', isDark); }, []); const toggleDarkMode = () => { const newDarkMode = !darkMode; setDarkMode(newDarkMode); localStorage.setItem('darkMode', newDarkMode); document.documentElement.classList.toggle('dark', newDarkMode); }; return (<button onClick={toggleDarkMode} className="p-2 rounded-full bg-white/10 text-white focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors duration-300" aria-label="Toggle dark mode">{darkMode ? <i className="fas fa-sun text-yellow-400"></i> : <i className="fas fa-moon"></i>}</button>); };
     const AchievementToast = ({ achievement, onDismiss }) => { useEffect(() => { const timer = setTimeout(onDismiss, 5000); return () => clearTimeout(timer); }, [onDismiss]); if (!achievement) return null; return ( <div className="fixed bottom-5 right-5 w-80 p-4 rounded-xl shadow-2xl animate-slideInUp z-[9999] glassmorphism"> <div className="flex items-center"> <div className="text-3xl text-yellow-400 mr-4"><i className={achievement.icon}></i></div> <div> <p className="font-bold text-lg text-white">Achievement Unlocked!</p> <p className="text-gray-200">{achievement.title}</p> </div> <button onClick={onDismiss} className="absolute top-2 right-2 text-white/50 hover:text-white">&times;</button> </div> </div> ); };
    const AppLoader = () => ( <div className="fixed inset-0 bg-slate-900 flex flex-col items-center justify-center z-[10000]"> <img src="https://raw.githubusercontent.com/ganeshdahal-HUE/practicece/6684a6cfa40eda8be7402689857a23575f0b723a/494645815_122099085086862980_1698079942897814974_n.jpg" alt="Logo" className="h-24 w-24 rounded-full shadow-lg mb-4 animate-pulse" /> <h1 className="text-3xl font-extrabold text-white tracking-tight">Balen Scholarship Prep</h1> <p className="text-white/70 mt-1">Preparing your dashboard...</p> </div> );
    const UserStats = ({ xp, streak, isPremium }) => { const level = Math.floor(xp / DATA.XP_PER_LEVEL) + 1; const xpInLevel = xp % DATA.XP_PER_LEVEL; const progress = (xpInLevel / DATA.XP_PER_LEVEL) * 100; const streakColor = streak > 30 ? "text-red-500" : streak > 10 ? "text-orange-400" : "text-amber-400"; return ( <div className="flex items-center gap-4 text-sm font-semibold"> {isPremium && <span className="flex items-center text-yellow-300 animate-pulse"><i className="fas fa-star mr-1"></i>PREMIUM</span>} {streak > 0 && <span className={`flex items-center ${streakColor}`}><i className={`fas fa-fire-alt mr-1`}></i>{streak} Day Streak</span>} <div className="flex items-center gap-2"> <span>Lvl {level}</span> <div className="w-20 h-2 bg-white/20 rounded-full"><div className="h-full bg-green-400 rounded-full" style={{width: `${progress}%`}}></div></div> </div> </div> ); };

    // =================================================================================
    // ===== NAME ENTRY SCREEN =====
    // =================================================================================
    const NameEntryScreen = ({ onNameSet }) => { const [name, setName] = useState(''); const handleSubmit = (e) => { e.preventDefault(); if (name.trim()) { onNameSet(name.trim()); } }; return ( <div className="min-h-screen w-full flex items-center justify-center p-4 bg-slate-900 bg-cover bg-center" style={{backgroundImage: "url('https://images.unsplash.com/photo-1557682250-33bd709cbe85?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D')"}}> <div className="w-full max-w-md glassmorphism rounded-2xl p-8 shadow-2xl animate-popIn"> <div className="text-center mb-8"> <img src="https://raw.githubusercontent.com/ganeshdahal-HUE/practicece/6684a6cfa40eda8be7402689857a23575f0b723a/494645815_122099085086862980_1698079942897814974_n.jpg" alt="Logo" className="h-20 w-20 rounded-full shadow-lg mx-auto mb-4 border-2 border-white/50" /> <h1 className="text-3xl font-bold text-white font-serif tracking-tight">Balen Scholarship Prep</h1> <p className="text-white/70 mt-2">Please enter your name to begin.</p> </div> <form onSubmit={handleSubmit} className="space-y-4"> <div className="relative"> <i className="fas fa-user absolute left-4 top-1/2 -translate-y-1/2 text-white/50"></i> <input type="text" value={name} onChange={(e) => setName(e.target.value)} placeholder="Enter Your Full Name" className="w-full pl-12 pr-4 py-3 rounded-lg border-0 bg-white/10 text-white placeholder-white/60 focus:ring-2 focus:ring-indigo-400 focus:outline-none transition" required /> </div> <button type="submit" className="w-full gradient-button text-white font-bold py-3 px-6 rounded-full shadow-lg text-lg uppercase tracking-wider mt-4">Continue</button> </form> </div> </div> ); };

    // =================================================================================
    // ===== HEADER & FOOTER =====
    // =================================================================================
    const Header = ({ setActiveSection, activeSection, isPremium, userStats, hasNewNotice, onLogoClick }) => { const [isMenuOpen, setIsMenuOpen] = useState(false); const navItems = [ { key: 'home', label: 'Dashboard' }, { key: 'quizzes', label: 'Daily Quizzes' }, { key: 'competition', label: 'Competition' }, { key: 'resources', label: 'Resources' }, { key: 'entertainment', label: 'Brain Break' }, { key: 'videos', label: 'Videos' }, { key: 'notices', label: 'Notices' }, { key: 'faqs', label: 'FAQs' } ]; return ( <header className="sticky top-0 z-50 text-white glassmorphism"> <div className="container mx-auto flex justify-between items-center p-4"> <div className="flex items-center space-x-3"> <button onClick={onLogoClick} className="flex items-center space-x-3 focus:outline-none"> <img src="https://raw.githubusercontent.com/ganeshdahal-HUE/practicece/6684a6cfa40eda8be7402689857a23575f0b723a/494645815_122099085086862980_1698079942897814974_n.jpg" alt="Site Logo" className="h-12 w-12 rounded-full shadow-md object-cover border-2 border-white/50" /> <div> <h1 className="text-xl sm:text-2xl font-extrabold tracking-tight">Balen Scholarship</h1> <div className="hidden md:block -mt-1"><UserStats {...userStats} isPremium={isPremium} /></div> </div> </button> </div> <nav className="hidden lg:flex items-center gap-2"> {navItems.map(btn => (<button key={btn.key} onClick={() => setActiveSection(btn.key)} className={`relative nav-button bg-white/10 hover:bg-white/20 font-semibold py-2 px-3 rounded-lg shadow-sm transition-all duration-300 ${activeSection === btn.key ? 'active' : ''} ${btn.key === 'notices' && hasNewNotice ? 'nav-button-notify' : ''}`}>{btn.label}</button>))} <DarkModeToggle /> </nav> <div className="lg:hidden flex items-center gap-2"> <DarkModeToggle /> <button onClick={() => setIsMenuOpen(!isMenuOpen)} className="p-2 rounded-md text-white bg-white/10 hover:bg-white/20"><i className="fas fa-bars text-xl"></i></button> </div> </div> {isMenuOpen && (<nav className="lg:hidden mt-4 p-4 border-t border-white/20 animate-fadeIn">{navItems.map(btn => (<button key={btn.key} onClick={() => { setActiveSection(btn.key); setIsMenuOpen(false); }} className={`w-full text-center nav-button bg-white/10 hover:bg-white/20 font-semibold py-3 px-4 rounded-lg shadow-sm mb-2 ${activeSection === btn.key ? 'active' : ''}`}>{btn.label}</button>))}</nav>)} </header> ); };
    const Footer = () => (<footer className="bg-slate-900 text-white p-6 text-center shadow-inner mt-8"><div className="container mx-auto"><p className="font-semibold">&copy; 2024 Balen Scholarship Prep. Designed by Ganesh Dahal.</p><div className="flex justify-center space-x-5 mt-3"><a href={DATA.whatsAppGroupLink} target="_blank" rel="noopener noreferrer" className="text-white/70 hover:text-green-400"><i className="fab fa-whatsapp text-xl"></i></a><a href="#" className="text-white/70 hover:text-blue-400"><i className="fab fa-facebook-f text-xl"></i></a><a href="#" className="text-white/70 hover:text-red-500"><i className="fab fa-youtube text-xl"></i></a></div></div></footer>);

    // =================================================================================
    // ===== MODAL COMPONENTS =====
    // =================================================================================
    const PaymentModal = ({ onPaymentSuccess, onClose, userName }) => { const [premiumCode, setPremiumCode] = useState(''); const [isLoading, setIsLoading] = useState(false); const [error, setError] = useState(''); const handleVerify = (e) => { e.preventDefault(); setError(''); const expectedCode = generatePremiumCode(userName); if (premiumCode === expectedCode) { setIsLoading(true); setTimeout(() => { setIsLoading(false); onPaymentSuccess(); }, 1500); } else { setError('Invalid Premium Code. Please check the code received from the admin.'); } }; return ( <div className="overlay"> <div className="modal-box glassmorphism text-white relative"> <button onClick={onClose} className="absolute top-4 right-4 text-white/50 hover:text-white text-2xl font-bold">&times;</button> <h2 className="text-3xl font-extrabold mb-2 font-serif">Unlock Premium Access</h2> <p className="text-white/80 mb-6">Gain instant access to all exclusive features.</p> <div className="text-center bg-green-900/50 border border-green-500/50 rounded-xl p-4 mb-6"> <p className="text-lg">One-Time Payment</p> <p className="text-5xl font-bold text-green-300">Rs. {DATA.premiumPrice}</p> </div> <div className="text-left space-y-4"> <div> <p className="font-bold text-lg mb-1">Step 1: Pay using eSewa</p> <p className="text-white/80">Open your eSewa app and send <span className="font-bold text-white">Rs. {DATA.premiumPrice}</span> to the following eSewa ID:</p> <div className="bg-black/30 p-3 rounded-lg mt-2 text-center text-xl font-mono tracking-widest">{DATA.esewaId}</div> </div> <div> <p className="font-bold text-lg mb-1">Step 2: Activate Your Account</p> <p className="text-white/80">After paying, contact the admin via WhatsApp to get your personal premium code, then enter it below to activate.</p> <a href={`https://wa.me/${DATA.whatsAppContactNumber}?text=${encodeURIComponent(`I have made the payment for the Balen Scholarship Prep Portal premium access. Please provide me with my premium code.`)}`} target="_blank" rel="noopener noreferrer" className="inline-block mt-2 mb-3 bg-green-500 text-white font-bold py-2 px-4 rounded-full text-sm"><i className="fab fa-whatsapp mr-2"></i>Contact Admin for Code</a> <form onSubmit={handleVerify} className="mt-2"> <input type="text" value={premiumCode} onChange={(e) => setPremiumCode(e.target.value)} placeholder="Enter Premium Code from Admin" className="w-full p-3 border-0 rounded-md bg-white/20 placeholder-white/60 text-white focus:ring-2 focus:ring-indigo-400 focus:outline-none" required /> {error && <p className="text-red-400 text-sm mt-2 text-center">{error}</p>} <button type="submit" className="w-full gradient-button text-white font-bold py-3 px-6 rounded-full shadow-lg text-lg mt-4" disabled={isLoading}> {isLoading ? ( <Fragment> <i className="fas fa-spinner fa-spin mr-2"></i>Activating... </Fragment> ) : ( <Fragment> <i className="fas fa-key mr-2"></i>Activate Premium </Fragment> )} </button> </form> </div> </div> </div> </div> ); };
    
    // Enhanced PDF Viewer with Annotation Support
    const PdfViewerModal = ({ pdfInfo, onClose, checkAndUnlockAchievement }) => { 
        if (!pdfInfo || !pdfInfo.url) return null; 
        const [isLoading, setIsLoading] = useState(true); 
        const viewerRef = useRef(null); 
        const pdfId = useMemo(() => pdfInfo.title.replace(/\s+/g, '_'), [pdfInfo]); 
        const [progressPage, setProgressPage] = useState(''); 
        const [savedPage, setSavedPage] = useState(null); 
        const [showSavedConfirmation, setShowSavedConfirmation] = useState(false);
        const [isFullscreen, setIsFullscreen] = useState(false);

        const getEmbedUrl = useCallback((url, page) => { 
            const fileIdMatch = url.match(/drive\.google\.com\/(?:file\/d\/|drive\/folders\/)([a-zA-Z0-9_-]+)/); 
            if (!fileIdMatch) return null; 
            let embedUrl = `https://drive.google.com/file/d/${fileIdMatch[1]}/preview`; 
            if (page) { embedUrl += `#page=${page}`; } 
            return embedUrl; 
        }, []); 

        useEffect(() => { 
            const savedPageData = localStorage.getItem(`pdfProgress_${pdfId}`); 
            if (savedPageData) { setSavedPage(savedPageData); setProgressPage(savedPageData); } 
        }, [pdfId]); 

        const handleSaveProgress = (e) => { 
            e.preventDefault(); 
            localStorage.setItem(`pdfProgress_${pdfId}`, progressPage); 
            setSavedPage(progressPage); 
            setShowSavedConfirmation(true); 
            setTimeout(() => setShowSavedConfirmation(false), 2500); 
        }; 

        const handleFullscreen = () => {
            if (!document.fullscreenElement) {
                viewerRef.current.requestFullscreen().then(() => {
                    setIsFullscreen(true);
                }).catch(err => {
                    console.error(`Error attempting to enable full-screen mode: ${err.message}`);
                });
            } else {
                document.exitFullscreen().then(() => {
                    setIsFullscreen(false);
                });
            }
        };

        const handlePdfLoad = () => {
            setIsLoading(false);
            // Track PDF reading for achievement
            const pdfReadCount = getJSONFromLocalStorage('pdfReadCount', {});
            if (!pdfReadCount[pdfId]) {
                pdfReadCount[pdfId] = true;
                localStorage.setItem('pdfReadCount', JSON.stringify(pdfReadCount));
                
                const readPDFs = Object.keys(pdfReadCount).length;
                if (readPDFs >= 5) {
                    checkAndUnlockAchievement('PDF_READER');
                }
            }
        };

        const preventContextMenu = (e) => e.preventDefault(); 

        const iframeUrl = useMemo(() => getEmbedUrl(pdfInfo.url, savedPage), [pdfInfo.url, savedPage, getEmbedUrl]); 
        
        return ( 
            <div className="overlay" onClick={onClose} onContextMenu={preventContextMenu}> 
                <div ref={viewerRef} className={`pdf-viewer-modal bg-slate-900 border border-slate-700 animate-popIn ${isFullscreen ? 'fixed inset-0 z-[2000]' : ''}`} onClick={e => e.stopPropagation()}> 
                    <div className="header flex-shrink-0"> 
                        <h3 className="truncate pr-4">{pdfInfo.title}</h3> 
                        <div className="flex items-center gap-2"> 
                            <form onSubmit={handleSaveProgress} className="hidden sm:flex items-center gap-2 relative"> 
                                <label htmlFor="page-input" className="text-sm text-slate-400">Bookmark Page:</label> 
                                <input id="page-input" type="number" value={progressPage} onChange={(e) => setProgressPage(e.target.value)} className="bg-slate-700 rounded-md px-2 py-1 w-20 text-center text-white placeholder-slate-400" placeholder="#" required /> 
                                <button type="submit" className="bg-indigo-600 hover:bg-indigo-700 text-white font-bold text-sm py-1 px-3 rounded-md">Save</button> 
                                {showSavedConfirmation && <div className="absolute top-full left-1/2 -translate-x-1/2 mt-2 bg-green-500 text-white text-xs font-bold px-2 py-1 rounded-full shadow-lg animate-popIn">Saved!</div>} 
                            </form> 
                            <button onClick={handleFullscreen} title="Fullscreen" className="bg-white/10 hover:bg-white/20 text-white rounded-full w-8 h-8 flex items-center justify-center"> 
                                <i className="fas fa-expand"></i> 
                            </button> 
                            <button onClick={onClose} title="Close" className="close-button text-xl">&times;</button> 
                        </div> 
                    </div> 
                    <div className="relative flex-grow bg-gray-800"> 
                        {isLoading && ( 
                            <div className="absolute inset-0 flex flex-col justify-center items-center text-white bg-gray-800/90 backdrop-blur-sm z-10 p-4 text-center"> 
                                <i className="fas fa-spinner fa-spin text-4xl mb-6"></i> 
                                <p className="font-bold text-lg">Loading HD Document...</p> 
                                {savedPage && <p className="text-sm text-gray-400 mt-2">Jumping to your bookmark on page {savedPage}...</p>} 
                                <div className="mt-8 bg-indigo-900/50 border border-indigo-500 rounded-lg p-4 max-w-md"> 
                                    <h4 className="font-semibold text-indigo-300 flex items-center justify-center gap-2"><i className="fas fa-info-circle"></i> Heads Up!</h4> 
                                    <p className="text-slate-300 text-sm mt-2"> To <strong>zoom</strong>, print, or go to a page, move your cursor to the <strong>top-right corner</strong> of the document viewer. A toolbar will appear. </p> 
                                </div> 
                            </div> 
                        )} 
                        <iframe 
                            src={iframeUrl} 
                            onLoad={handlePdfLoad}
                            className={`w-full h-full border-0 transition-opacity duration-500 ${isLoading ? 'opacity-0' : 'opacity-100'}`} 
                            title="HD PDF Viewer" 
                            sandbox="allow-scripts allow-same-origin allow-forms"
                        ></iframe> 
                    </div> 
                </div> 
            </div> 
        ); 
    };
    
    const CompulsoryNoticeModal = ({ notice, onClose }) => { if (!notice) return null; return ( <div className="overlay"> <div className="modal-box glassmorphism text-white relative animate-popIn"> <h2 className="text-3xl font-bold mb-4 font-serif">{notice.title}</h2> <p className="text-sm text-white/70 mb-4">Posted on: {notice.date}</p> <div className="text-left text-white/90 leading-relaxed my-6 max-h-[40vh] overflow-y-auto" dangerouslySetInnerHTML={{ __html: notice.content }}></div> <button onClick={onClose} className="gradient-button text-white font-bold py-2 px-8 rounded-full shadow-md mt-4">I Understand</button> </div> </div> ); };
    const WinnerCertificateModal = ({ winnerInfo, onClose }) => { if (!winnerInfo) return null; const { name, rank, score, color, medal } = winnerInfo; const rankText = rank === 1 ? "1st Place" : rank === 2 ? "2nd Place" : "3rd Place"; const rankColorClass = {amber: 'border-amber-400', slate: 'border-slate-400', orange: 'border-orange-500'}[color] || 'border-gray-400'; const handleDownload = () => { const certElement = document.getElementById('winner-certificate'); if (certElement) { html2canvas(certElement, {backgroundColor: '#111827', useCORS: true}).then(canvas => { const link = document.createElement('a'); link.download = `Winner_Certificate_${name}.png`; link.href = canvas.toDataURL('image/png'); link.click(); }); } }; return ( <div className="overlay"> <div className="modal-box bg-slate-900/80 backdrop-blur-lg border border-white/20 p-0 max-w-2xl w-full"> <div id="winner-certificate" className="relative p-8 text-white bg-slate-900"> <div className={`absolute inset-0 border-8 ${rankColorClass} rounded-lg`}></div> <div className="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/az-subtle.png')] opacity-10"></div> <div className="relative text-center"> <h1 className="text-4xl font-serif text-amber-300">Certificate of Achievement</h1> <p className="mt-2 text-lg text-slate-300">Awarded for Outstanding Performance</p> <div className="my-8"> <p className="text-slate-400">This certificate is proudly presented to</p> <p className="text-5xl font-script my-3 text-white">{name}</p> <p className="text-slate-400">for securing the</p> <p className={`text-4xl font-bold my-2 text-${color}-400`}>{rankText} {medal}</p> <p className="text-slate-400">in the weekly quiz competition held on</p> <p className="font-semibold text-lg text-white">{DATA.competitionResults.date}</p> <p className="text-slate-400 mt-1">with a score of <span className="font-bold text-white">{score}</span>.</p> </div> <div className="flex justify-between items-center mt-10 border-t border-amber-400/30 pt-4"> <div><p className="font-script text-3xl">Ganesh Dahal</p><p className="text-xs text-slate-400 tracking-widest">PORTAL CREATOR</p></div> <img src="https://i.ibb.co/T0f0d3j/gold-seal-embossed.png" alt="Seal" className="w-24 h-24" /> </div> </div> </div> <div className="p-4 bg-black/20 flex flex-col sm:flex-row gap-4 justify-center"> <button onClick={handleDownload} className="gradient-button text-white font-bold py-2 px-6 rounded-full"><i className="fas fa-download mr-2"></i>Download Certificate</button> <button onClick={onClose} className="bg-white/20 text-white font-bold py-2 px-6 rounded-full">Close</button> </div> </div> </div> ); };
    const CourseCompletionCelebration = ({ userName, onViewCertificate }) => { useEffect(() => { const container = document.getElementById('confetti-container'); if (!container) return; for (let i = 0; i < 50; i++) { const confetti = document.createElement('div'); confetti.className = 'confetti'; confetti.style.left = `${Math.random() * 100}vw`; confetti.style.animationDelay = `${Math.random() * 3}s`; confetti.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 50%)`; container.appendChild(confetti); } }, []); return (<div className="overlay"><div id="confetti-container" className="absolute inset-0 overflow-hidden z-0"></div><div className="modal-box glassmorphism text-white relative animate-popIn border-2 border-amber-400/50 max-w-lg"><div className="text-7xl mb-4 animate-[tada_1.5s_ease-in-out]">ðŸŽ‰</div><h1 className="text-4xl font-extrabold font-serif text-amber-300">Congratulations, {userName}!</h1><p className="mt-4 text-lg text-white/90">You have successfully completed all the daily quizzes in the Balen Scholarship Preparatory Program!</p><p className="mt-2 text-white/80">Your dedication is inspiring. We wish you the best of luck in your exam!</p><button onClick={onViewCertificate} className="gradient-button text-white font-bold py-3 px-8 rounded-full shadow-lg text-lg mt-8">View Your Certificate <i className="fas fa-arrow-right ml-2"></i></button></div></div>); };
    
    // =================================================================================
    // ===== NEW COMPONENTS FOR UPDATED FEATURES =====
    // =================================================================================
    
    // Help Note Modal Component
    const HelpNoteModal = ({ onClose }) => {
        const [title, setTitle] = useState('');
        const [description, setDescription] = useState('');
        const [file, setFile] = useState(null);
        
        const handleSubmit = (e) => {
            e.preventDefault();
            if (!title.trim() || !description.trim()) {
                alert('Please fill in all fields');
                return;
            }
            
            const message = `*Help Note Submission*\n\n*Title:* ${title}\n*Description:* ${description}\n\nSubmitted via Balen Scholarship Prep Portal`;
            const whatsappUrl = `https://wa.me/${DATA.whatsAppContactNumber}?text=${encodeURIComponent(message)}`;
            
            window.open(whatsappUrl, '_blank');
            onClose();
        };
        
        return (
            <div className="overlay">
                <div className="modal-box glassmorphism text-white relative max-w-md">
                    <button onClick={onClose} className="absolute top-4 right-4 text-white/50 hover:text-white text-2xl font-bold">&times;</button>
                    <h2 className="text-2xl font-bold mb-4">Submit Help Note</h2>
                    <form onSubmit={handleSubmit} className="space-y-4">
                        <div>
                            <label className="block text-sm font-medium mb-2">Title</label>
                            <input 
                                type="text" 
                                value={title}
                                onChange={(e) => setTitle(e.target.value)}
                                className="w-full p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/60 focus:ring-2 focus:ring-indigo-400 focus:outline-none"
                                placeholder="Enter note title"
                                required
                            />
                        </div>
                        <div>
                            <label className="block text-sm font-medium mb-2">Description</label>
                            <textarea 
                                value={description}
                                onChange={(e) => setDescription(e.target.value)}
                                className="w-full p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/60 focus:ring-2 focus:ring-indigo-400 focus:outline-none"
                                placeholder="Describe your note or question"
                                rows="4"
                                required
                            />
                        </div>
                        <div>
                            <label className="block text-sm font-medium mb-2">Upload PDF (Optional)</label>
                            <input 
                                type="file"
                                accept=".pdf"
                                onChange={(e) => setFile(e.target.files[0])}
                                className="w-full p-2 rounded-lg bg-white/10 border border-white/20 text-white file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-500 file:text-white hover:file:bg-indigo-600"
                            />
                        </div>
                        <button type="submit" className="w-full gradient-button text-white font-bold py-3 px-6 rounded-full">
                            <i className="fab fa-whatsapp mr-2"></i>Send via WhatsApp
                        </button>
                    </form>
                </div>
            </div>
        );
    };

    // Good Friday Quiz Report Card Component
    const GoodFridayReportCard = ({ user, score, totalQuestions, onClose, onShare }) => {
        const percentage = Math.round((score / totalQuestions) * 100);
        const remarks = percentage >= 90 ? "Excellent!" : 
                       percentage >= 75 ? "Very Good!" : 
                       percentage >= 60 ? "Good" : 
                       percentage >= 40 ? "Fair" : "Needs Improvement";
        
        const handleDownload = () => {
            const element = document.getElementById('good-friday-report-card');
            html2canvas(element, { backgroundColor: '#ffffff', useCORS: true }).then(canvas => {
                const link = document.createElement('a');
                link.download = `GoodFriday_Report_${user.name}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
            });
        };
        
        const handleShare = (platform) => {
            const element = document.getElementById('good-friday-report-card');
            html2canvas(element, { backgroundColor: '#ffffff', useCORS: true }).then(canvas => {
                canvas.toBlob(blob => {
                    const file = new File([blob], `GoodFriday_Report_${user.name}.png`, { type: 'image/png' });
                    
                    if (platform === 'whatsapp') {
                        const text = `Check out my Good Friday Quiz result! I scored ${score}/${totalQuestions} (${percentage}%) - ${remarks}`;
                        const url = `https://wa.me/?text=${encodeURIComponent(text)}`;
                        window.open(url, '_blank');
                    } else if (platform === 'facebook') {
                        // Facebook sharing logic would go here
                        alert('Facebook sharing would be implemented here');
                    }
                });
            });
        };
        
        return (
            <div className="overlay">
                <div className="modal-box bg-white max-w-2xl w-full p-0 overflow-hidden">
                    <div id="good-friday-report-card" className="p-8 bg-gradient-to-br from-blue-50 to-indigo-100">
                        <div className="text-center mb-6">
                            <div className="flex justify-center items-center mb-4">
                                <img src="https://raw.githubusercontent.com/ganeshdahal-HUE/practicece/6684a6cfa40eda8be7402689857a23575f0b723a/494645815_122099085086862980_1698079942897814974_n.jpg" 
                                     alt="Portal Logo" 
                                     className="h-16 w-16 rounded-full mr-4" />
                                <div>
                                    <h1 className="text-3xl font-bold text-indigo-800">Balen Scholarship Prep</h1>
                                    <p className="text-indigo-600">Good Friday Quiz Report Card</p>
                                </div>
                            </div>
                        </div>
                        
                        <div className="bg-white rounded-2xl p-6 shadow-lg mb-6">
                            <div className="flex items-center mb-6">
                                {user.photo ? (
                                    <img src={user.photo} alt="User" className="h-20 w-20 rounded-full object-cover border-4 border-indigo-200 mr-4" />
                                ) : (
                                    <div className="h-20 w-20 rounded-full bg-indigo-100 flex items-center justify-center border-4 border-indigo-200 mr-4">
                                        <i className="fas fa-user text-indigo-400 text-2xl"></i>
                                    </div>
                                )}
                                <div>
                                    <h2 className="text-2xl font-bold text-gray-800">{user.name}</h2>
                                    <p className="text-gray-600">Symbol: {user.symbol}</p>
                                </div>
                            </div>
                            
                            <div className="grid grid-cols-2 gap-4 mb-6">
                                <div className="text-center p-4 bg-green-50 rounded-lg">
                                    <p className="text-sm text-green-600">Score</p>
                                    <p className="text-3xl font-bold text-green-700">{score}/{totalQuestions}</p>
                                </div>
                                <div className="text-center p-4 bg-blue-50 rounded-lg">
                                    <p className="text-sm text-blue-600">Percentage</p>
                                    <p className="text-3xl font-bold text-blue-700">{percentage}%</p>
                                </div>
                            </div>
                            
                            <div className="text-center mb-6">
                                <p className="text-lg font-semibold text-gray-700">Remarks</p>
                                <p className={`text-2xl font-bold ${
                                    percentage >= 90 ? 'text-green-600' :
                                    percentage >= 75 ? 'text-blue-600' :
                                    percentage >= 60 ? 'text-yellow-600' :
                                    'text-red-600'
                                }`}>{remarks}</p>
                            </div>
                            
                            <div className="text-center text-gray-500 text-sm">
                                <p>Date: {new Date().toLocaleDateString()}</p>
                                <div className="mt-4 pt-4 border-t border-gray-200">
                                    <p className="font-script text-xl text-indigo-700">Ganesh Dahal</p>
                                    <p className="text-gray-600">Chairman</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div className="p-4 bg-gray-50 flex flex-wrap justify-center gap-2">
                        <button onClick={handleDownload} className="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-full">
                            <i className="fas fa-download mr-2"></i>Download
                        </button>
                        <button onClick={() => handleShare('whatsapp')} className="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-full">
                            <i className="fab fa-whatsapp mr-2"></i>Share on WhatsApp
                        </button>
                        <button onClick={() => handleShare('facebook')} className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-full">
                            <i className="fab fa-facebook mr-2"></i>Share on Facebook
                        </button>
                        <button onClick={onClose} className="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-full">
                            Close
                        </button>
                    </div>
                </div>
            </div>
        );
    };

    // Profile Component
// Enhanced Profile Section with Beautiful Achievement Display
// Enhanced Profile Section with Certificate Downloads
const ProfileSection = ({ userStats, completedQuizzes, unlockedAchievements, onClose, onShowPremiumCert, onShowCompletionCert }) => {
    const [userPhoto, setUserPhoto] = useState(userStats.photo || '');
    const [showPhotoUpload, setShowPhotoUpload] = useState(false);
    const [activeTab, setActiveTab] = useState('overview');
    const [showCertificateModal, setShowCertificateModal] = useState(null); // 'premium' or 'completion'
    
    const handlePhotoUpload = (e) => {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const photoUrl = e.target.result;
                setUserPhoto(photoUrl);
                // Save to localStorage
                const stats = getJSONFromLocalStorage('balenUserStats', userStats);
                stats.photo = photoUrl;
                localStorage.setItem('balenUserStats', JSON.stringify(stats));
            };
            reader.readAsDataURL(file);
        }
    };
    
    const completedCount = Object.keys(completedQuizzes).length;
    const totalQuizzes = DATA.dailyQuizzes.length;
    const progressPercentage = Math.round((completedCount / totalQuizzes) * 100);
    const isCourseCompleted = completedCount === totalQuizzes;
    const isPremium = localStorage.getItem('balenPremiumUnlocked') === 'true';

    // Achievement data with descriptions and unlock conditions
    const achievementDetails = {
        'FIRST_QUIZ': { 
            description: 'Complete your first quiz',
            color: 'from-blue-500 to-cyan-500',
            iconColor: 'text-blue-400',
            glow: 'shadow-blue-500/50'
        },
        'ALL_QUIZZES': { 
            description: 'Complete all daily quizzes',
            color: 'from-green-500 to-emerald-500',
            iconColor: 'text-green-400',
            glow: 'shadow-green-500/50'
        },
        'STREAK_7': { 
            description: 'Maintain 7-day login streak',
            color: 'from-orange-500 to-red-500',
            iconColor: 'text-orange-400',
            glow: 'shadow-orange-500/50'
        },
        'STREAK_14': { 
            description: 'Maintain 14-day login streak',
            color: 'from-purple-500 to-pink-500',
            iconColor: 'text-purple-400',
            glow: 'shadow-purple-500/50'
        },
        'STREAK_30': { 
            description: 'Maintain 30-day login streak',
            color: 'from-yellow-500 to-amber-500',
            iconColor: 'text-yellow-400',
            glow: 'shadow-yellow-500/50'
        },
        'BRAIN_ACADEMY': { 
            description: 'Complete brain teaser and riddle in one day',
            color: 'from-indigo-500 to-blue-500',
            iconColor: 'text-indigo-400',
            glow: 'shadow-indigo-500/50'
        },
        'THREE_WINS': { 
            description: 'Achieve top 3 position 3 times',
            color: 'from-rose-500 to-pink-500',
            iconColor: 'text-rose-400',
            glow: 'shadow-rose-500/50'
        },
        'PREMIUM_USER': { 
            description: 'Unlock premium access',
            color: 'from-amber-500 to-yellow-500',
            iconColor: 'text-amber-400',
            glow: 'shadow-amber-500/50'
        },
        'PDF_READER': { 
            description: 'Read 5 different PDF resources',
            color: 'from-teal-500 to-green-500',
            iconColor: 'text-teal-400',
            glow: 'shadow-teal-500/50'
        }
    };

    // Calculate user level and progress
    const userLevel = Math.floor(userStats.xp / DATA.XP_PER_LEVEL) + 1;
    const xpInLevel = userStats.xp % DATA.XP_PER_LEVEL;
    const xpProgress = (xpInLevel / DATA.XP_PER_LEVEL) * 100;
    const xpToNextLevel = DATA.XP_PER_LEVEL - xpInLevel;

    // Certificate Download Functions
    const handleDownloadCertificate = (type) => {
        if (type === 'premium' && isPremium) {
            setShowCertificateModal('premium');
        } else if (type === 'completion' && isCourseCompleted) {
            setShowCertificateModal('completion');
        }
    };

   // In the ProfileSection component, update the certificate section to use the new design:

const CertificateDownloadSection = () => (
    <div className="bg-gradient-to-br from-amber-900/30 to-yellow-900/30 backdrop-blur-xl rounded-3xl p-6 border border-amber-500/30 shadow-2xl">
        <h4 className="text-2xl font-bold text-amber-400 mb-6 flex items-center">
            <i className="fas fa-award mr-3 animate-pulse"></i>
            Your Certificates
        </h4>
        
        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
            {/* Premium Certificate */}
            <div className={`relative p-6 rounded-2xl backdrop-blur-sm border-2 transition-all duration-500 transform hover:scale-105 ${
                isPremium 
                    ? 'bg-gradient-to-br from-amber-500/20 to-yellow-500/20 border-amber-500/50 shadow-2xl shadow-amber-500/25 animate-glow cursor-pointer'
                    : 'bg-white/5 border-white/10 grayscale opacity-60'
            }`} onClick={() => isPremium && setShowCertificateModal('premium')}>
                <div className="text-center">
                    <div className="inline-flex items-center justify-center w-16 h-16 bg-amber-500/20 rounded-2xl mb-4">
                        <i className="fas fa-crown text-2xl text-amber-400"></i>
                    </div>
                    <h5 className="text-xl font-bold text-white mb-2">Premium Certificate</h5>
                    <p className="text-white/70 text-sm mb-4">
                        Official certificate for premium membership
                    </p>
                    {isPremium ? (
                        <div className="bg-amber-500/20 text-amber-300 py-2 px-4 rounded-full text-sm font-semibold backdrop-blur-sm">
                            <i className="fas fa-download mr-2"></i>
                            Download Available
                        </div>
                    ) : (
                        <div className="bg-white/10 text-white/40 py-2 px-4 rounded-full text-sm font-semibold">
                            <i className="fas fa-lock mr-2"></i>
                            Premium Required
                        </div>
                    )}
                </div>
            </div>

            {/* Course Completion Certificate */}
   // In the CertificateDownloadSection component, update the completion certificate card:
<div 
    className={`relative p-4 rounded-xl border-2 transition-all duration-300 transform hover:scale-105 cursor-pointer ${
        isCourseCompleted 
            ? 'bg-green-500/20 border-green-500/50 shadow-lg' 
            : 'bg-white/5 border-white/10 opacity-60'
    }`} 
    onClick={() => isCourseCompleted && setShowCertificateModal('completion')}
>
    <div className="text-center">
        <div className="inline-flex items-center justify-center w-12 h-12 bg-green-500/20 rounded-xl mb-3">
            <i className="fas fa-graduation-cap text-green-400"></i>
        </div>
        <h5 className="text-lg font-bold text-white mb-1">Course Completion</h5>
        <p className="text-white/70 text-xs mb-3">
            Professional certificate
        </p>
        {isCourseCompleted ? (
            <div className="bg-green-500/30 text-green-300 py-1 px-3 rounded-full text-xs font-semibold">
                <i className="fas fa-download mr-1"></i>
                Download Available
            </div>
        ) : (
            <div className="bg-white/10 text-white/40 py-1 px-3 rounded-full text-xs">
                {completedCount}/{totalQuizzes} Quizzes
            </div>
        )}
    </div>
</div>
        </div>

        {/* Progress Info */}
        {!isCourseCompleted && (
            <div className="mt-6 p-4 bg-white/5 rounded-2xl backdrop-blur-sm">
                <div className="flex items-center justify-between mb-2">
                    <span className="text-white/70">Course Progress</span>
                    <span className="text-green-400 font-semibold">{progressPercentage}%</span>
                </div>
                <div className="w-full bg-white/20 rounded-full h-2">
                    <div 
                        className="bg-gradient-to-r from-green-500 to-emerald-500 h-2 rounded-full transition-all duration-1000 ease-out"
                        style={{ width: `${progressPercentage}%` }}
                    ></div>
                </div>
                <p className="text-white/60 text-sm mt-2 text-center">
                    Complete {totalQuizzes - completedCount} more quizzes to earn your certificate!
                </p>
            </div>
        )}
    </div>
);

    return (
        <section id="profile" className="py-8 px-4 md:px-8 bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 min-h-screen relative overflow-hidden">
            {/* Certificate Modals */}
// Inside the ProfileSection return statement, add these modals:
{showCertificateModal === 'premium' && (
    <PremiumCertificate 
        userName={userStats.name} 
        onDownload={() => {
            const element = document.getElementById('certificate');
            if(element) {
                html2canvas(element, {backgroundColor: '#1e293b', useCORS: true}).then(canvas => {
                    const link = document.createElement('a');
                    link.download = `Premium_Certificate_${userStats.name}.png`;
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                });
            }
            setShowCertificateModal(null);
        }}
        onClose={() => setShowCertificateModal(null)}
    />
)}

{showCertificateModal === 'completion' && (
    <CompletionCertificate 
        userName={userStats.name} 
        onDownload={() => {
            const element = document.getElementById('completion-certificate');
            if(element) {
                html2canvas(element, {backgroundColor: '#ffffff', useCORS: true}).then(canvas => {
                    const link = document.createElement('a');
                    link.download = `Course_Completion_Certificate_${userStats.name}.png`;
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                });
            }
            setShowCertificateModal(null);
        }}
        onClose={() => setShowCertificateModal(null)}
    />
)}
            {/* Animated Background Elements */}
            <div className="absolute inset-0 overflow-hidden">
                <div className="absolute -top-40 -right-32 w-80 h-80 bg-purple-500 rounded-full mix-blend-multiply filter blur-xl opacity-20 animate-pulse"></div>
                <div className="absolute -bottom-40 -left-32 w-80 h-80 bg-cyan-500 rounded-full mix-blend-multiply filter blur-xl opacity-20 animate-pulse delay-1000"></div>
                <div className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-96 h-96 bg-pink-500 rounded-full mix-blend-multiply filter blur-xl opacity-10 animate-pulse delay-500"></div>
            </div>

            <div className="container mx-auto max-w-6xl relative z-10">
                {/* Header */}
                <div className="flex justify-between items-center mb-8">
                    <h2 className="text-4xl md:text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-purple-400 animate-pulse">
                        Your Profile
                    </h2>
                    <button 
                        onClick={onClose}
                        className="p-3 rounded-full bg-white/10 hover:bg-white/20 text-white transition-all duration-300 hover:scale-110 hover:rotate-90"
                    >
                        <i className="fas fa-times text-xl"></i>
                    </button>
                </div>

                {/* Profile Header with Glow Effect */}
                <div className="bg-gradient-to-r from-slate-800/50 to-purple-900/50 backdrop-blur-xl rounded-3xl p-8 mb-8 border border-white/10 shadow-2xl animate-fadeIn">
                    <div className="flex flex-col md:flex-row items-center gap-8">
                        {/* Profile Photo with Glow */}
                        <div className="relative group">
                            <div className="absolute inset-0 bg-gradient-to-r from-cyan-500 to-purple-500 rounded-full blur-lg opacity-75 group-hover:opacity-100 transition-opacity duration-500 animate-pulse"></div>
                            {userPhoto ? (
                                <img 
                                    src={userPhoto} 
                                    alt="Profile" 
                                    className="relative h-32 w-32 rounded-full object-cover border-4 border-white/20 shadow-2xl transform group-hover:scale-105 transition-transform duration-300"
                                />
                            ) : (
                                <div className="relative h-32 w-32 rounded-full bg-gradient-to-br from-slate-700 to-slate-800 flex items-center justify-center border-4 border-white/20 shadow-2xl transform group-hover:scale-105 transition-transform duration-300">
                                    <i className="fas fa-user text-4xl text-white/60"></i>
                                </div>
                            )}
                            <button 
                                onClick={() => setShowPhotoUpload(!showPhotoUpload)}
                                className="absolute -bottom-2 -right-2 bg-gradient-to-r from-cyan-500 to-blue-500 text-white rounded-full p-3 shadow-lg transform hover:scale-110 transition-transform duration-300 animate-bounce"
                            >
                                <i className="fas fa-camera"></i>
                            </button>
                        </div>

                        {showPhotoUpload && (
                            <div className="absolute mt-40 bg-slate-800/90 backdrop-blur-lg p-6 rounded-2xl shadow-2xl border border-white/20 z-20 animate-popIn">
                                <input 
                                    type="file" 
                                    accept="image/*" 
                                    onChange={handlePhotoUpload}
                                    className="w-full text-white file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-gradient-to-r file:from-cyan-500 file:to-blue-500 file:text-white hover:file:bg-gradient-to-r hover:file:from-cyan-600 hover:file:to-blue-600"
                                />
                            </div>
                        )}

                        {/* User Info */}
                        <div className="flex-1 text-center md:text-left">
                            <h3 className="text-3xl md:text-4xl font-bold text-white mb-2 animate-fadeIn">
                                {userStats.name}
                            </h3>
                            <div className="flex flex-wrap justify-center md:justify-start gap-4 mb-4">
                                <div className="flex items-center gap-2 bg-white/10 px-4 py-2 rounded-full backdrop-blur-sm">
                                    <i className="fas fa-fire text-orange-400 animate-pulse"></i>
                                    <span className="text-white font-semibold">{userStats.streak} Day Streak</span>
                                </div>
                                <div className="flex items-center gap-2 bg-white/10 px-4 py-2 rounded-full backdrop-blur-sm">
                                    <i className="fas fa-star text-yellow-400"></i>
                                    <span className="text-white font-semibold">{userStats.xp} XP</span>
                                </div>
                                <div className="flex items-center gap-2 bg-white/10 px-4 py-2 rounded-full backdrop-blur-sm">
                                    <i className="fas fa-trophy text-amber-400"></i>
                                    <span className="text-white font-semibold">Level {userLevel}</span>
                                </div>
                                {isPremium && (
                                    <div className="flex items-center gap-2 bg-amber-500/20 px-4 py-2 rounded-full backdrop-blur-sm border border-amber-500/50">
                                        <i className="fas fa-crown text-amber-400"></i>
                                        <span className="text-amber-300 font-semibold">PREMIUM</span>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>

                    {/* XP Progress Bar */}
                    <div className="mt-6">
                        <div className="flex justify-between text-white mb-2">
                            <span className="text-sm">Level {userLevel}</span>
                            <span className="text-sm">{xpToNextLevel} XP to next level</span>
                        </div>
                        <div className="w-full bg-white/20 rounded-full h-3 backdrop-blur-sm">
                            <div 
                                className="bg-gradient-to-r from-cyan-500 to-purple-500 h-3 rounded-full transition-all duration-1000 ease-out shadow-lg shadow-cyan-500/25"
                                style={{ width: `${xpProgress}%` }}
                            ></div>
                        </div>
                    </div>
                </div>

                {/* Navigation Tabs */}
                <div className="flex flex-wrap gap-2 mb-8 justify-center">
                    {['overview', 'achievements', 'certificates', 'progress', 'stats'].map(tab => (
                        <button
                            key={tab}
                            onClick={() => setActiveTab(tab)}
                            className={`px-6 py-3 rounded-full font-semibold capitalize transition-all duration-300 transform hover:scale-105 ${
                                activeTab === tab 
                                    ? 'bg-gradient-to-r from-cyan-500 to-purple-500 text-white shadow-lg shadow-cyan-500/25' 
                                    : 'bg-white/10 text-white/70 hover:bg-white/20 backdrop-blur-sm'
                            }`}
                        >
                            {tab === 'certificates' ? (
                                <i className="fas fa-award mr-2"></i>
                            ) : tab === 'achievements' ? (
                                <i className="fas fa-trophy mr-2"></i>
                            ) : tab === 'progress' ? (
                                <i className="fas fa-chart-line mr-2"></i>
                            ) : tab === 'stats' ? (
                                <i className="fas fa-chart-bar mr-2"></i>
                            ) : (
                                <i className="fas fa-home mr-2"></i>
                            )}
                            {tab}
                        </button>
                    ))}
                </div>

                {/* Tab Content */}
                <div className="animate-fadeIn">
                    {activeTab === 'overview' && (
                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            {/* Quick Stats */}
                            <div className="bg-gradient-to-br from-slate-800/50 to-cyan-900/50 backdrop-blur-xl rounded-3xl p-6 border border-white/10 shadow-2xl">
                                <h4 className="text-2xl font-bold text-cyan-400 mb-6 flex items-center">
                                    <i className="fas fa-chart-line mr-3"></i>
                                    Quick Stats
                                </h4>
                                <div className="space-y-4">
                                    <div className="flex justify-between items-center p-4 bg-white/5 rounded-2xl backdrop-blur-sm">
                                        <span className="text-white/80">Quizzes Completed</span>
                                        <span className="text-2xl font-bold text-cyan-400">{completedCount}/{totalQuizzes}</span>
                                    </div>
                                    <div className="flex justify-between items-center p-4 bg-white/5 rounded-2xl backdrop-blur-sm">
                                        <span className="text-white/80">Achievements</span>
                                        <span className="text-2xl font-bold text-purple-400">
                                            {Object.keys(unlockedAchievements).length}/{Object.keys(DATA.achievementsList).length}
                                        </span>
                                    </div>
                                    <div className="flex justify-between items-center p-4 bg-white/5 rounded-2xl backdrop-blur-sm">
                                        <span className="text-white/80">Current Streak</span>
                                        <span className="text-2xl font-bold text-orange-400">{userStats.streak} days ðŸ”¥</span>
                                    </div>
                                    <div className="flex justify-between items-center p-4 bg-white/5 rounded-2xl backdrop-blur-sm">
                                        <span className="text-white/80">Certificates</span>
                                        <span className="text-2xl font-bold text-amber-400">
                                            {(isPremium ? 1 : 0) + (isCourseCompleted ? 1 : 0)}/2
                                        </span>
                                    </div>
                                </div>
                            </div>

                            {/* Certificate Preview */}
                            <div className="bg-gradient-to-br from-slate-800/50 to-purple-900/50 backdrop-blur-xl rounded-3xl p-6 border border-white/10 shadow-2xl">
                                <h4 className="text-2xl font-bold text-purple-400 mb-6 flex items-center">
                                    <i className="fas fa-award mr-3"></i>
                                    Certificates
                                </h4>
                                <div className="space-y-4">
                                    {/* Premium Certificate Preview */}
                                    <div 
                                        className={`flex items-center justify-between p-4 rounded-2xl backdrop-blur-sm cursor-pointer transform hover:scale-105 transition-transform duration-300 ${
                                            isPremium 
                                                ? 'bg-amber-500/20 border border-amber-500/50' 
                                                : 'bg-white/5 border border-white/10 opacity-60'
                                        }`}
                                        onClick={() => handleDownloadCertificate('premium')}
                                    >
                                        <div className="flex items-center gap-3">
                                            <div className={`p-3 rounded-xl ${
                                                isPremium ? 'bg-amber-500/30' : 'bg-white/10'
                                            }`}>
                                                <i className={`fas fa-crown ${isPremium ? 'text-amber-400' : 'text-white/40'}`}></i>
                                            </div>
                                            <div>
                                                <p className={`font-semibold ${isPremium ? 'text-white' : 'text-white/60'}`}>
                                                    Premium Certificate
                                                </p>
                                                <p className={`text-sm ${isPremium ? 'text-amber-300' : 'text-white/40'}`}>
                                                    {isPremium ? 'Download available' : 'Premium required'}
                                                </p>
                                            </div>
                                        </div>
                                        <i className={`fas fa-chevron-right ${isPremium ? 'text-amber-400' : 'text-white/40'}`}></i>
                                    </div>

                                    {/* Completion Certificate Preview */}
                                    <div 
                                        className={`flex items-center justify-between p-4 rounded-2xl backdrop-blur-sm cursor-pointer transform hover:scale-105 transition-transform duration-300 ${
                                            isCourseCompleted 
                                                ? 'bg-green-500/20 border border-green-500/50' 
                                                : 'bg-white/5 border border-white/10 opacity-60'
                                        }`}
                                        onClick={() => handleDownloadCertificate('completion')}
                                    >
                                        <div className="flex items-center gap-3">
                                            <div className={`p-3 rounded-xl ${
                                                isCourseCompleted ? 'bg-green-500/30' : 'bg-white/10'
                                            }`}>
                                                <i className={`fas fa-graduation-cap ${isCourseCompleted ? 'text-green-400' : 'text-white/40'}`}></i>
                                            </div>
                                            <div>
                                                <p className={`font-semibold ${isCourseCompleted ? 'text-white' : 'text-white/60'}`}>
                                                    Course Completion
                                                </p>
                                                <p className={`text-sm ${isCourseCompleted ? 'text-green-300' : 'text-white/40'}`}>
                                                    {isCourseCompleted ? 'Download available' : `${completedCount}/${totalQuizzes} quizzes`}
                                                </p>
                                            </div>
                                        </div>
                                        <i className={`fas fa-chevron-right ${isCourseCompleted ? 'text-green-400' : 'text-white/40'}`}></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {activeTab === 'certificates' && (
                        <CertificateDownloadSection />
                    )}

                    {activeTab === 'achievements' && (
                        <div className="bg-gradient-to-br from-slate-800/50 to-purple-900/50 backdrop-blur-xl rounded-3xl p-6 border border-white/10 shadow-2xl">
                            <h4 className="text-2xl font-bold text-purple-400 mb-6 flex items-center">
                                <i className="fas fa-trophy mr-3"></i>
                                Your Achievements
                            </h4>
                            
                            {/* Achievement Stats */}
                            <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                                <div className="text-center p-4 bg-white/5 rounded-2xl backdrop-blur-sm">
                                    <div className="text-3xl font-bold text-cyan-400">{Object.keys(unlockedAchievements).length}</div>
                                    <div className="text-white/60 text-sm">Unlocked</div>
                                </div>
                                <div className="text-center p-4 bg-white/5 rounded-2xl backdrop-blur-sm">
                                    <div className="text-3xl font-bold text-purple-400">{Object.keys(DATA.achievementsList).length}</div>
                                    <div className="text-white/60 text-sm">Total</div>
                                </div>
                                <div className="text-center p-4 bg-white/5 rounded-2xl backdrop-blur-sm">
                                    <div className="text-3xl font-bold text-green-400">
                                        {Math.round((Object.keys(unlockedAchievements).length / Object.keys(DATA.achievementsList).length) * 100)}%
                                    </div>
                                    <div className="text-white/60 text-sm">Progress</div>
                                </div>
                                <div className="text-center p-4 bg-white/5 rounded-2xl backdrop-blur-sm">
                                    <div className="text-3xl font-bold text-amber-400">{userStats.streak}</div>
                                    <div className="text-white/60 text-sm">Current Streak</div>
                                </div>
                            </div>

                            {/* Achievements Grid */}
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                {Object.entries(DATA.achievementsList).map(([achievementId, achievement]) => {
                                    const isUnlocked = unlockedAchievements[achievementId];
                                    const details = achievementDetails[achievementId] || {
                                        description: achievement.description,
                                        color: 'from-gray-500 to-gray-600',
                                        iconColor: 'text-gray-400',
                                        glow: 'shadow-gray-500/20'
                                    };

                                    return (
                                        <div 
                                            key={achievementId}
                                            className={`relative p-6 rounded-2xl backdrop-blur-sm border-2 transition-all duration-500 transform hover:scale-105 ${
                                                isUnlocked 
                                                    ? `bg-gradient-to-br ${details.color} border-transparent shadow-2xl ${details.glow} animate-glow`
                                                    : 'bg-white/5 border-white/10 grayscale opacity-60'
                                            }`}
                                        >
                                            {/* Achievement Icon */}
                                            <div className={`text-center mb-4 p-4 rounded-xl ${
                                                isUnlocked 
                                                    ? 'bg-white/20 backdrop-blur-sm' 
                                                    : 'bg-white/5'
                                            }`}>
                                                <i className={`${achievement.icon} ${
                                                    isUnlocked ? details.iconColor : 'text-gray-400'
                                                } text-4xl mb-2`}></i>
                                            </div>

                                            {/* Achievement Info */}
                                            <h5 className={`text-xl font-bold text-center mb-2 ${
                                                isUnlocked ? 'text-white' : 'text-white/60'
                                            }`}>
                                                {achievement.title}
                                            </h5>
                                            <p className={`text-center text-sm mb-4 ${
                                                isUnlocked ? 'text-white/80' : 'text-white/40'
                                            }`}>
                                                {details.description}
                                            </p>

                                            {/* Status Badge */}
                                            <div className={`text-center py-1 px-3 rounded-full text-xs font-semibold ${
                                                isUnlocked 
                                                    ? 'bg-white/20 text-white backdrop-blur-sm' 
                                                    : 'bg-white/10 text-white/40'
                                            }`}>
                                                {isUnlocked ? (
                                                    <span className="flex items-center justify-center gap-1">
                                                        <i className="fas fa-check"></i>
                                                        Unlocked
                                                    </span>
                                                ) : (
                                                    <span className="flex items-center justify-center gap-1">
                                                        <i className="fas fa-lock"></i>
                                                        Locked
                                                    </span>
                                                )}
                                            </div>

                                            {/* Glow Effect for Unlocked */}
                                            {isUnlocked && (
                                                <div className="absolute inset-0 rounded-2xl bg-gradient-to-r from-transparent via-white/10 to-transparent transform -skew-x-12 animate-shine"></div>
                                            )}
                                        </div>
                                    );
                                })}
                            </div>

                            {/* Empty State */}
                            {Object.keys(unlockedAchievements).length === 0 && (
                                <div className="text-center py-12">
                                    <i className="fas fa-trophy text-6xl text-white/20 mb-4"></i>
                                    <h5 className="text-xl font-bold text-white/60 mb-2">No Achievements Yet</h5>
                                    <p className="text-white/40">Start completing quizzes and maintaining your streak to unlock achievements!</p>
                                </div>
                            )}
                        </div>
                    )}

                    {activeTab === 'progress' && (
                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            {/* Quiz Progress */}
                            <div className="bg-gradient-to-br from-slate-800/50 to-cyan-900/50 backdrop-blur-xl rounded-3xl p-6 border border-white/10 shadow-2xl">
                                <h4 className="text-2xl font-bold text-cyan-400 mb-6 flex items-center">
                                    <i className="fas fa-tasks mr-3"></i>
                                    Quiz Progress
                                </h4>
                                <div className="space-y-6">
                                    <div className="text-center">
                                        <div className="text-5xl font-bold text-cyan-400 mb-2">{completedCount}</div>
                                        <div className="text-white/60">Quizzes Completed</div>
                                    </div>
                                    <div className="w-full bg-white/20 rounded-full h-4 backdrop-blur-sm">
                                        <div 
                                            className="bg-gradient-to-r from-cyan-500 to-blue-500 h-4 rounded-full transition-all duration-1000 ease-out shadow-lg shadow-cyan-500/25"
                                            style={{ width: `${progressPercentage}%` }}
                                        ></div>
                                    </div>
                                    <div className="text-center text-white/60">
                                        {progressPercentage}% Complete â€¢ {totalQuizzes - completedCount} remaining
                                    </div>
                                    {isCourseCompleted && (
                                        <div className="text-center p-4 bg-green-500/20 rounded-2xl border border-green-500/50">
                                            <i className="fas fa-check-circle text-green-400 text-2xl mb-2"></i>
                                            <p className="text-green-300 font-semibold">Course Completed!</p>
                                            <p className="text-green-200 text-sm">You can download your certificate</p>
                                        </div>
                                    )}
                                </div>
                            </div>

                            {/* Certificate Progress */}
                            <div className="bg-gradient-to-br from-slate-800/50 to-amber-900/50 backdrop-blur-xl rounded-3xl p-6 border border-white/10 shadow-2xl">
                                <h4 className="text-2xl font-bold text-amber-400 mb-6 flex items-center">
                                    <i className="fas fa-award mr-3"></i>
                                    Certificate Progress
                                </h4>
                                <div className="space-y-6">
                                    <div className="grid grid-cols-2 gap-4">
                                        <div className="text-center p-4 bg-amber-500/20 rounded-2xl border border-amber-500/50">
                                            <div className="text-2xl font-bold text-amber-400 mb-1">
                                                {isPremium ? '1' : '0'}/1
                                            </div>
                                            <div className="text-amber-300 text-sm">Premium</div>
                                        </div>
                                        <div className="text-center p-4 bg-green-500/20 rounded-2xl border border-green-500/50">
                                            <div className="text-2xl font-bold text-green-400 mb-1">
                                                {isCourseCompleted ? '1' : '0'}/1
                                            </div>
                                            <div className="text-green-300 text-sm">Completion</div>
                                        </div>
                                    </div>
                                    <div className="text-center">
                                        <div className="text-3xl font-bold text-white mb-2">
                                            {(isPremium ? 1 : 0) + (isCourseCompleted ? 1 : 0)}/2
                                        </div>
                                        <div className="text-white/60">Certificates Earned</div>
                                    </div>
                                    <CertificateDownloadSection />
                                </div>
                            </div>
                        </div>
                    )}

                    {activeTab === 'stats' && (
                        <div className="bg-gradient-to-br from-slate-800/50 to-purple-900/50 backdrop-blur-xl rounded-3xl p-6 border border-white/10 shadow-2xl">
                            <h4 className="text-2xl font-bold text-purple-400 mb-6 flex items-center">
                                <i className="fas fa-chart-bar mr-3"></i>
                                Detailed Statistics
                            </h4>
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                <div className="text-center p-6 bg-white/5 rounded-2xl backdrop-blur-sm transform hover:scale-105 transition-transform duration-300">
                                    <i className="fas fa-brain text-3xl text-cyan-400 mb-3"></i>
                                    <div className="text-2xl font-bold text-white">{userStats.xp}</div>
                                    <div className="text-white/60">Total XP</div>
                                </div>
                                <div className="text-center p-6 bg-white/5 rounded-2xl backdrop-blur-sm transform hover:scale-105 transition-transform duration-300">
                                    <i className="fas fa-layer-group text-3xl text-green-400 mb-3"></i>
                                    <div className="text-2xl font-bold text-white">{userLevel}</div>
                                    <div className="text-white/60">Current Level</div>
                                </div>
                                <div className="text-center p-6 bg-white/5 rounded-2xl backdrop-blur-sm transform hover:scale-105 transition-transform duration-300">
                                    <i className="fas fa-calendar-check text-3xl text-orange-400 mb-3"></i>
                                    <div className="text-2xl font-bold text-white">{userStats.streak}</div>
                                    <div className="text-white/60">Login Streak</div>
                                </div>
                                <div className="text-center p-6 bg-white/5 rounded-2xl backdrop-blur-sm transform hover:scale-105 transition-transform duration-300">
                                    <i className="fas fa-check-circle text-3xl text-purple-400 mb-3"></i>
                                    <div className="text-2xl font-bold text-white">{completedCount}</div>
                                    <div className="text-white/60">Quizzes Done</div>
                                </div>
                                <div className="text-center p-6 bg-white/5 rounded-2xl backdrop-blur-sm transform hover:scale-105 transition-transform duration-300">
                                    <i className="fas fa-trophy text-3xl text-amber-400 mb-3"></i>
                                    <div className="text-2xl font-bold text-white">{Object.keys(unlockedAchievements).length}</div>
                                    <div className="text-white/60">Achievements</div>
                                </div>
                                <div className="text-center p-6 bg-white/5 rounded-2xl backdrop-blur-sm transform hover:scale-105 transition-transform duration-300">
                                    <i className="fas fa-award text-3xl text-blue-400 mb-3"></i>
                                    <div className="text-2xl font-bold text-white">
                                        {(isPremium ? 1 : 0) + (isCourseCompleted ? 1 : 0)}
                                    </div>
                                    <div className="text-white/60">Certificates</div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>

                {/* Motivational Quote */}
                <div className="text-center mt-12 p-6 bg-gradient-to-r from-cyan-500/10 to-purple-500/10 backdrop-blur-xl rounded-3xl border border-white/10">
                    <p className="text-white/80 italic text-lg">
                        "Education is the most powerful weapon which you can use to change the world."
                    </p>
                    <p className="text-white/60 mt-2">- Nelson Mandela</p>
                </div>
            </div>

            {/* Add custom CSS for animations */}
            <style jsx>{`
                @keyframes glow {
                    0%, 100% { box-shadow: 0 0 20px rgba(59, 130, 246, 0.5); }
                    50% { box-shadow: 0 0 40px rgba(59, 130, 246, 0.8), 0 0 60px rgba(139, 92, 246, 0.6); }
                }
                @keyframes shine {
                    0% { transform: translateX(-100%) skewX(-12deg); }
                    100% { transform: translateX(200%) skewX(-12deg); }
                }
                .animate-glow {
                    animation: glow 2s ease-in-out infinite;
                }
                .animate-shine {
                    animation: shine 3s ease-in-out infinite;
                }
            `}</style>
        </section>
    );
};

    // =================================================================================
    // ===== PAGE SECTIONS =====
    // =================================================================================
    const HomeDashboard = ({ setActiveSection, userName, completedQuizzes, userStats, isPremium, activityLog }) => {
        const completedCount = Object.keys(completedQuizzes).length;
        const nextQuiz = DATA.dailyQuizzes.find(q => !completedQuizzes[q.day]);
        const xpInLevel = userStats.xp % DATA.XP_PER_LEVEL;
        const xpProgressPercentage = (xpInLevel / DATA.XP_PER_LEVEL) * 100;
        
        const getGreeting = () => { const hour = new Date().getHours(); if (hour < 12) return "Good morning"; if (hour < 18) return "Good afternoon"; return "Good evening"; };
        
        const CircularProgress = ({ percentage, size = 120 }) => {
            const strokeWidth = 10;
            const radius = (size - strokeWidth) / 2;
            const circumference = 2 * Math.PI * radius;
            const offset = circumference - (percentage / 100) * circumference;
            return (
                <div className="relative" style={{ width: size, height: size }}>
                    <svg width={size} height={size} className="transform -rotate-90"><circle cx={size / 2} cy={size / 2} r={radius} stroke="currentColor" strokeWidth={strokeWidth} fill="transparent" className="text-gray-200 dark:text-slate-700" /><circle cx={size / 2} cy={size / 2} r={radius} stroke="currentColor" strokeWidth={strokeWidth} fill="transparent" strokeDasharray={circumference} strokeDashoffset={offset} className="text-green-500 transition-all duration-700 ease-out" strokeLinecap="round" /></svg>
                    <div className="absolute inset-0 flex flex-col items-center justify-center"><span className="text-2xl font-bold">{Math.round(userStats.xp % DATA.XP_PER_LEVEL)}</span><span className="text-xs text-gray-500">XP</span></div>
                </div>
            );
        };

        let nextStepButton;
        if (nextQuiz) {
            if (!isPremium && nextQuiz.isPremium) {
                nextStepButton = <button onClick={() => setActiveSection('resources')} className="gradient-button text-white font-bold py-3 px-8 rounded-full shadow-xl text-lg"> Unlock Premium Quiz <i className="fas fa-star ml-2"></i> </button>;
            } else {
                nextStepButton = <button onClick={() => setActiveSection('quizzes')} className="gradient-button text-white font-bold py-3 px-8 rounded-full shadow-xl text-lg"> Go to Quizzes <i className="fas fa-arrow-right ml-2"></i> </button>;
            }
        }

        return (
            <section id="home">
                <div className="relative bg-gradient-to-br from-indigo-800 via-purple-800 to-blue-900 text-white overflow-hidden animate-gradient"><div className="container mx-auto px-4 py-16 md:py-24 relative z-10"><div className="text-center"><h1 className="text-4xl md:text-5xl font-black leading-tight tracking-tight animate-fadeIn">{getGreeting()}, <span className="text-transparent bg-clip-text bg-gradient-to-r from-blue-300 to-purple-300">{userName}!</span></h1><p className="mt-4 text-lg text-gray-200 max-w-xl mx-auto animate-fadeIn" style={{ animationDelay: '200ms' }}>Your journey to success continues here. Let's make today productive.</p></div></div></div>
                <div className="container mx-auto px-4 -mt-12 relative z-20">
                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div className="lg:col-span-2 space-y-6">
                            <div className="bg-white dark:bg-slate-900 p-6 rounded-2xl shadow-xl animate-slideInUp card-hover">
                                <h2 className="text-2xl font-bold text-indigo-600 dark:text-indigo-400 mb-4">Your Next Step</h2>
                                {nextQuiz ? (<div><p className="text-lg mb-2">Up next is the quiz for Day {nextQuiz.day}:</p><h3 className="text-3xl font-extrabold mb-4">{nextQuiz.title}</h3><p className="text-gray-500 dark:text-gray-400 mb-6">Subject: {nextQuiz.subject}</p>{nextStepButton}</div>) : (<div className="text-center py-8"><span className="text-7xl animate-tada inline-block">ðŸŽ‰</span><h3 className="text-3xl font-extrabold mt-4 text-green-500">All Quizzes Completed!</h3><p className="text-lg mt-2">Incredible work! Check your achievements or join a competition.</p></div>)}
                            </div>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div className="bg-white dark:bg-slate-900 p-6 rounded-2xl shadow-xl animate-slideInUp card-hover" style={{animationDelay: '100ms'}}>
                                    <h2 className="text-2xl font-bold text-indigo-600 dark:text-indigo-400 mb-4">Quick Links</h2>
                                    <div className="grid grid-cols-2 gap-4"><button onClick={() => setActiveSection('competition')} className="flex flex-col items-center justify-center p-4 bg-gray-100 dark:bg-slate-800 rounded-lg hover:bg-indigo-100 dark:hover:bg-indigo-900/50 transition-colors"><i className="fas fa-trophy text-3xl text-indigo-500 mb-2"></i><span className="font-semibold text-sm text-center">Competition</span></button><button onClick={() => setActiveSection('resources')} className="flex flex-col items-center justify-center p-4 bg-gray-100 dark:bg-slate-800 rounded-lg hover:bg-green-100 dark:hover:bg-green-900/50 transition-colors"><i className="fas fa-book-open text-3xl text-green-500 mb-2"></i><span className="font-semibold text-sm text-center">Resources</span></button></div>
                                </div>
                                <div className="bg-white dark:bg-slate-900 p-6 rounded-2xl shadow-xl animate-slideInUp card-hover" style={{animationDelay: '200ms'}}>
                                    <h2 className="text-2xl font-bold text-indigo-600 dark:text-indigo-400 mb-4">Recent Activity</h2>
                                    {activityLog && activityLog.length > 0 ? (<ul className="space-y-3">{activityLog.slice(0, 3).map((activity, index) => (<li key={index} className="flex items-center text-sm animate-fadeIn" style={{animationDelay: `${index * 100}ms`}}><i className="fas fa-history text-gray-400 mr-3"></i><span className="text-gray-600 dark:text-gray-400">{activity}</span></li>))}</ul>) : <p className="text-gray-500 text-sm">No recent activity yet. Complete a quiz to get started!</p>}
                                </div>
                            </div>
                        </div>
                        <div className="bg-white dark:bg-slate-900 p-6 rounded-2xl shadow-xl animate-slideInUp card-hover flex flex-col" style={{animationDelay: '300ms'}}>
                            <h2 className="text-2xl font-bold text-indigo-600 dark:text-indigo-400 mb-4">Your Progress</h2>
                            <div className="flex items-center justify-center my-4"><CircularProgress percentage={xpProgressPercentage} /></div>
                            <div className="space-y-4 mt-auto">
                                <div><p className="font-semibold">Level {Math.floor(userStats.xp / DATA.XP_PER_LEVEL) + 1}</p><p className="text-sm text-gray-500 dark:text-gray-400">{DATA.XP_PER_LEVEL - xpInLevel} XP to next level</p></div>
                                <div><p className="font-semibold">Current Streak</p><p className="text-3xl font-extrabold text-orange-500">{userStats.streak} <span className="text-lg font-bold">Days ðŸ”¥</span></p></div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        );
    };
    const EntertainmentSection = ({ onBrainBreakComplete, checkAndUnlockAchievement }) => { const dayOfYear = Math.floor((new Date() - new Date(new Date().getFullYear(), 0, 0)) / (1000 * 60 * 60 * 24)); const [dailyProgress, setDailyProgress] = useState( getJSONFromLocalStorage(`brainBreakProgress_${dayOfYear}`, { teasers: {}, riddle: false }) ); const [riddleGuess, setRiddleGuess] = useState(''); const [riddleStatus, setRiddleStatus] = useState('unanswered'); const teasers = DATA.entertainment.brainTeasers; const dailyTeasers = useMemo(() => [ {...teasers[dayOfYear % teasers.length], id: `d${dayOfYear}t0`}, {...teasers[(dayOfYear + 5) % teasers.length], id: `d${dayOfYear}t1`}, {...teasers[(dayOfYear + 10) % teasers.length], id: `d${dayOfYear}t2`} ], [dayOfYear]); const riddle = useMemo(() => DATA.entertainment.riddles[dayOfYear % DATA.entertainment.riddles.length], [dayOfYear]); const quote = useMemo(() => DATA.entertainment.motivationalQuotes[dayOfYear % DATA.entertainment.motivationalQuotes.length], [dayOfYear]); const completedTeasersCount = Object.values(dailyProgress.teasers || {}).filter(ans => ans.isCorrect).length; const handleProgress = (activityType) => { onBrainBreakComplete(); if ((activityType === 'riddle' && completedTeasersCount > 0) || (activityType === 'teaser' && dailyProgress.riddle)) { checkAndUnlockAchievement('BRAIN_ACADEMY'); } }; const handleTeaserSubmit = (teaserId, option, isCorrect) => { if(dailyProgress.teasers && dailyProgress.teasers[teaserId]) return; const newProgress = { ...dailyProgress, teasers: { ...dailyProgress.teasers, [teaserId]: { answer: option, isCorrect } }}; setDailyProgress(newProgress); localStorage.setItem(`brainBreakProgress_${dayOfYear}`, JSON.stringify(newProgress)); if (isCorrect) { handleProgress('teaser'); } }; const handleRiddleSubmit = (e) => { e.preventDefault(); if(dailyProgress.riddle) return; if (riddle.answers.includes(riddleGuess.toLowerCase().trim())) { setRiddleStatus('correct'); const newProgress = { ...dailyProgress, riddle: true }; setDailyProgress(newProgress); localStorage.setItem(`brainBreakProgress_${dayOfYear}`, JSON.stringify(newProgress)); handleProgress('riddle'); } else { setRiddleStatus('incorrect'); setTimeout(() => setRiddleStatus('unanswered'), 2000); } }; return ( <section id="entertainment" className="py-12 px-4 md:px-8 bg-gray-50 dark:bg-slate-800"> <div className="container mx-auto"> <h2 className="text-4xl font-extrabold text-center text-red-500 dark:text-red-400 mb-4 animate-fadeIn">Brain Break Zone</h2> <p className="text-center text-lg text-gray-600 dark:text-gray-400 max-w-2xl mx-auto mb-8">Take a fun break, challenge your mind, and earn extra XP!</p> <div className="bg-white dark:bg-slate-900 p-6 rounded-2xl shadow-lg card-hover animate-slideInUp mb-8"> <h3 className="text-2xl font-bold text-indigo-600 dark:text-indigo-400 mb-4 flex items-center"><i className="fas fa-quote-left mr-3"></i>Quote of the Day</h3> <p className="text-xl italic text-gray-700 dark:text-gray-300">"{quote.quote}"</p> <p className="text-right mt-4 font-semibold text-gray-500 dark:text-gray-400">- {quote.author}</p> </div> <div className="grid grid-cols-1 lg:grid-cols-2 gap-8"> <div className="bg-white dark:bg-slate-900 p-6 rounded-2xl shadow-lg card-hover animate-slideInUp"> <h3 className="text-2xl font-bold text-green-600 dark:text-green-400 mb-4 flex items-center"><i className="fas fa-bolt mr-3"></i>Daily Brain Teasers</h3> <div className="space-y-6"> {dailyTeasers.map((teaser) => { const userAnswer = dailyProgress.teasers ? dailyProgress.teasers[teaser.id] : undefined; return ( <div key={teaser.id}> <p className="text-lg text-gray-700 dark:text-gray-300 mb-4 font-semibold">{teaser.question}</p> <div className="space-y-3"> {teaser.options.map(option => { const isCorrect = option === teaser.correctAnswer; const isSelected = userAnswer?.answer === option; let buttonClass = "w-full text-left p-3 rounded-lg border-2 transition-all font-semibold "; if (userAnswer) { if (isCorrect) buttonClass += "bg-green-200 border-green-400 text-green-800"; else if (isSelected) buttonClass += "bg-red-200 border-red-400 text-red-800"; else buttonClass += "bg-gray-100 dark:bg-slate-800 border-gray-200 dark:border-slate-700 opacity-60"; } else { buttonClass += "bg-gray-100 dark:bg-slate-800 border-gray-200 dark:border-slate-700 hover:bg-indigo-100 hover:border-indigo-400"; } return <button key={option} disabled={!!userAnswer} onClick={() => handleTeaserSubmit(teaser.id, option, isCorrect)} className={buttonClass}>{option}</button>; })} </div> {userAnswer?.isCorrect && <p className="mt-4 text-sm font-semibold text-green-500 animate-tada">Completed! +{DATA.XP_PER_BRAIN_BREAK} XP</p>} </div> ) })} </div> </div> <div className="bg-white dark:bg-slate-900 p-6 rounded-2xl shadow-lg card-hover animate-slideInUp" style={{animationDelay: '100ms'}}> <h3 className="text-2xl font-bold text-amber-600 dark:text-amber-400 mb-4 flex items-center"><i className="fas fa-puzzle-piece mr-3"></i>Riddle Challenge</h3> <p className="text-lg text-gray-700 dark:text-gray-300 mb-4">{riddle.riddle}</p> {(riddleStatus !== 'correct' && !dailyProgress.riddle) ? ( <form onSubmit={handleRiddleSubmit} className="flex gap-2"> <input type="text" value={riddleGuess} onChange={e => setRiddleGuess(e.target.value)} placeholder="Your answer..." className="flex-grow p-2 rounded-lg border-2 bg-gray-100 dark:bg-slate-800 focus:ring-2 focus:ring-amber-500" /> <button type="submit" className="bg-amber-500 text-white font-bold px-4 rounded-lg">Submit</button> </form> ) : null} {(riddleStatus === 'correct' || dailyProgress.riddle) && <p className="text-green-500 font-bold animate-tada">Correct! +{DATA.XP_PER_BRAIN_BREAK} XP</p>} {riddleStatus === 'incorrect' && <p className="text-red-500 font-bold">Not quite, try again!</p>} </div> </div> </div> </section> ); };
    
    // NEW FULLSCREEN QUIZ VIEWER COMPONENT
    const FullscreenQuizViewer = ({ quiz, onClose }) => {
        const [isLoading, setIsLoading] = useState(true);

        return (
            <div className="fullscreen-quiz-viewer">
                <div className="header">
                    <h3 className="truncate pr-4">{quiz.title}</h3>
                    <button onClick={onClose} title="Close Quiz" className="bg-red-500 hover:bg-red-600 text-white rounded-full w-8 h-8 flex items-center justify-center text-lg font-bold">
                        &times;
                    </button>
                </div>
                <div className="relative flex-grow bg-gray-800">
                    {isLoading && (
                        <div className="absolute inset-0 flex flex-col justify-center items-center text-white bg-gray-800 z-10 p-4 text-center">
                            <i className="fas fa-spinner fa-spin text-4xl mb-4"></i>
                            <p className="font-bold">Loading Quiz...</p>
                        </div>
                    )}
                    <iframe
                        src={quiz.link}
                        onLoad={() => setIsLoading(false)}
                        className={`w-full h-full transition-opacity duration-500 ${isLoading ? 'opacity-0' : 'opacity-100'}`}
                        title={quiz.title}
                        sandbox="allow-scripts allow-same-origin"
                    ></iframe>
                </div>
            </div>
        );
    };

    const QuizzesSection = ({ isPremium, completedQuizzes, userStats, onQuizComplete, onPremiumUnlock, onStateRefresh, checkAndUnlockAchievement }) => {
        const [showPaymentModal, setShowPaymentModal] = useState(false);
        const [showShareModal, setShowShareModal] = useState(false);
        const [activeQuiz, setActiveQuiz] = useState(null);
        const { unlockedByStreak, unlockedByShare, hasShared } = getJSONFromLocalStorage('balenQuizUnlocks', { unlockedByStreak: 0, unlockedByShare: 0, hasShared: false, dailyUnlocks: 0 });

        const getDailyPaceInfo = () => {
            const today = new Date().toISOString().split('T')[0];
            const storedPace = getJSONFromLocalStorage('balenDailyPace', { date: today, count: 0 });
            if (storedPace.date !== today) {
                const newPace = { date: today, count: 0 };
                localStorage.setItem('balenDailyPace', JSON.stringify(newPace));
                return newPace;
            }
            return storedPace;
        };
        const dailyPaceInfo = getDailyPaceInfo();

        // Calculate free user limit (45% of total quizzes)
        const FREE_USER_QUIZ_LIMIT = Math.floor(DATA.dailyQuizzes.length * 0.45);
        const completedCount = Object.keys(completedQuizzes).length;
        const availableByXP = Math.floor(userStats.xp / 100); // Every 100 XP unlocks one premium quiz

        const preparedQuizzes = useMemo(() => {
            const quizzesCompletedPremium = DATA.dailyQuizzes.filter(q => q.isPremium && completedQuizzes[q.day]).length;
            const canUnlockReward = !isPremium && (unlockedByStreak + unlockedByShare + availableByXP > quizzesCompletedPremium);
            const numCompleted = Object.keys(completedQuizzes).length;

            return DATA.dailyQuizzes.map((quiz, index) => {
                let status = 'Locked', statusText = 'Complete prior quizzes to unlock.', buttonText = 'Locked';
                if (completedQuizzes[quiz.day]) {
                    status = 'Completed'; statusText = 'You have completed this quiz.'; buttonText = 'Play Again';
                    return { ...quiz, status, statusText, buttonText };
                }
                const quizzesBefore = DATA.dailyQuizzes.slice(0, index);
                if (!quizzesBefore.every(q => completedQuizzes[q.day])) { return { ...quiz, status, statusText, buttonText }; }
                const canUnlockMoreToday = dailyPaceInfo.count < 2;
                if (!canUnlockMoreToday) { status = 'Locked'; statusText = "You've unlocked your 2 quizzes for today. Come back tomorrow to continue."; buttonText = 'Locked'; return { ...quiz, status, statusText, buttonText }; }
                if (isPremium) { status = 'Unlocked'; statusText = `You can unlock ${2 - dailyPaceInfo.count} more quizzes today.`; buttonText = 'Start Quiz'; } 
                else {
                    if (numCompleted >= FREE_USER_QUIZ_LIMIT) { 
                        if (quiz.isPremium) {
                            if (canUnlockReward) { 
                                status = 'Unlocked'; 
                                statusText = 'Unlock a premium quiz with your rewards!'; 
                                buttonText = 'Unlock with Reward'; 
                            } else { 
                                status = 'Requires Premium'; 
                                statusText = 'Share to unlock 5 premium quizzes or upgrade to Premium.'; 
                                buttonText = 'Share to Unlock'; 
                            }
                        } else {
                            status = 'Locked'; 
                            statusText = `You've completed all ${FREE_USER_QUIZ_LIMIT} available free quizzes.`; 
                            buttonText = 'Share to Unlock More';
                        }
                    } else if (quiz.isPremium) {
                        if (canUnlockReward) { status = 'Unlocked'; statusText = 'Unlock a premium quiz with a reward!'; buttonText = 'Unlock with Reward'; } 
                        else { status = 'Requires Premium'; statusText = 'Share to unlock premium quizzes.'; buttonText = 'Share to Unlock'; }
                    } else { status = 'Unlocked'; statusText = `You can unlock ${2 - dailyPaceInfo.count} more quizzes today.`; buttonText = 'Start Quiz'; }
                }
                return { ...quiz, status, statusText, buttonText };
            });
        }, [completedQuizzes, isPremium, unlockedByStreak, unlockedByShare, dailyPaceInfo, availableByXP]);

        const handleQuizClick = (quiz, status) => {
            if (status !== 'Unlocked' && status !== 'Completed') {
                if (status.includes('Share')) {
                    setShowShareModal(true);
                    return;
                }
                if (status === 'Requires Premium') {
                    setShowPaymentModal(true);
                    return;
                }
                return;
            }
            if (status === 'Unlocked') {
                if (!completedQuizzes[quiz.day]) {
                    const currentPace = getDailyPaceInfo();
                    localStorage.setItem('balenDailyPace', JSON.stringify({ date: currentPace.date, count: currentPace.count + 1 }));
                    onStateRefresh(); 
                }
            }
            onQuizComplete(quiz.day);
            setActiveQuiz(quiz);
        };
        
        const handleShare = () => { 
            localStorage.setItem('balenQuizUnlocks', JSON.stringify({ 
                unlockedByStreak, 
                unlockedByShare: 5, 
                hasShared: true,
                dailyUnlocks: 0
            })); 
            setShowShareModal(false); 
            onStateRefresh(); 
        };

        return (
            <section id="quizzes" className="py-12 px-4 md:px-8 bg-gray-50 dark:bg-slate-800">
                {activeQuiz && <FullscreenQuizViewer quiz={activeQuiz} onClose={() => setActiveQuiz(null)} />}
                <div className="container mx-auto">
                    <h2 className="text-4xl font-extrabold text-center text-red-500 dark:text-red-400 mb-10 animate-fadeIn">Daily Quizzes</h2>
                    <div className="mb-10 p-6 bg-white dark:bg-slate-900 rounded-2xl shadow-md animate-popIn">
                        <h3 className="text-2xl font-bold text-gray-900 dark:text-white mb-4">Your Quiz Progress</h3>
                        <p className="text-lg text-gray-600 dark:text-gray-400 mt-2">
                            {Object.keys(completedQuizzes).length} out of {DATA.dailyQuizzes.length} quizzes completed
                            {!isPremium && ` (${FREE_USER_QUIZ_LIMIT} free quizzes available)`}
                        </p>
                        {!isPremium && (
                            <div className="mt-4 p-4 bg-amber-50 dark:bg-amber-900/20 rounded-lg">
                                <p className="text-amber-700 dark:text-amber-300 font-semibold">
                                    <i className="fas fa-info-circle mr-2"></i>
                                    Free users can access {FREE_USER_QUIZ_LIMIT} quizzes ({Math.floor(FREE_USER_QUIZ_LIMIT/DATA.dailyQuizzes.length*100)}% of total)
                                </p>
                            </div>
                        )}
                    </div>
                    {!isPremium && ( 
                        <div className="flex flex-col md:flex-row gap-4 mb-8"> 
                            {hasShared ? (
                                <div className="flex-1 text-center bg-green-100 dark:bg-green-900/50 p-6 rounded-2xl shadow"> 
                                    <h3 className="text-2xl font-bold text-green-700 dark:text-green-300">Thank You For Sharing!</h3> 
                                    <p className="text-green-600 dark:text-green-400 my-2">
                                        You've unlocked {unlockedByShare} premium quizzes + {availableByXP} from XP. Keep up your daily streak to unlock more!
                                    </p>
                                    <div className="flex justify-center gap-4 mt-4">
                                        <div className="bg-white dark:bg-green-800 p-3 rounded-lg">
                                            <p className="text-sm text-green-600 dark:text-green-300">From Sharing</p>
                                            <p className="text-2xl font-bold">{unlockedByShare}</p>
                                        </div>
                                        <div className="bg-white dark:bg-green-800 p-3 rounded-lg">
                                            <p className="text-sm text-green-600 dark:text-green-300">From XP</p>
                                            <p className="text-2xl font-bold">{availableByXP}</p>
                                        </div>
                                    </div>
                                </div>
                            ) : (
                                <div className="flex-1 text-center bg-green-100 dark:bg-green-900/50 p-6 rounded-2xl shadow"> 
                                    <h3 className="text-2xl font-bold text-green-700 dark:text-green-300">Share & Unlock Premium Quizzes!</h3> 
                                    <p className="text-green-600 dark:text-green-400 my-2">
                                        Share our portal to unlock 5 premium quizzes for free! Plus, earn 1 premium quiz for every 100 XP.
                                    </p> 
                                    <button onClick={() => setShowShareModal(true)} className="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-8 rounded-full shadow-lg text-lg">Share Now</button> 
                                </div> 
                            )} 
                            <div className="flex-1 text-center bg-amber-100 dark:bg-amber-900/50 p-6 rounded-2xl shadow"> 
                                <h3 className="text-2xl font-bold text-amber-700 dark:text-amber-300">Unlock All Quizzes</h3> 
                                <p className="text-amber-600 dark:text-amber-400 my-2">Get premium access to unlock all quizzes and materials permanently.</p> 
                                <button onClick={() => setShowPaymentModal(true)} className="gradient-button text-white font-bold py-3 px-8 rounded-full shadow-lg text-lg">Get Premium</button> 
                            </div> 
                        </div> 
                    )}
                    {showPaymentModal && <PaymentModal onPaymentSuccess={onPremiumUnlock} onClose={() => setShowPaymentModal(false)} userName={userStats.name} />}
                    {showShareModal && (
                        <div className="overlay">
                            <div className="modal-box glassmorphism text-white max-w-md">
                                <h3 className="text-2xl font-bold mb-4">Share to Unlock Quizzes!</h3>
                                <p className="mt-2 mb-4">Share this portal with your friends to unlock 5 premium quizzes instantly!</p>
                                <div className="flex justify-center gap-4 text-4xl mb-6">
                                    <a 
                                        href={`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(window.location.href)}`} 
                                        target="_blank" 
                                        rel="noopener noreferrer" 
                                        className="text-blue-400 hover:scale-110 transition-transform"
                                    >
                                        <i className="fab fa-facebook"></i>
                                    </a>
                                    <a 
                                        href={`https://wa.me/?text=${encodeURIComponent(`Check out this amazing Balen Scholarship Prep Portal: ${window.location.href}`)}`} 
                                        target="_blank" 
                                        rel="noopener noreferrer" 
                                        className="text-green-400 hover:scale-110 transition-transform"
                                    >
                                        <i className="fab fa-whatsapp"></i>
                                    </a>
                                </div>
                                <p className="text-sm text-white/70 mb-4">
                                    After sharing, click the button below to claim your reward.
                                </p>
                                <button onClick={handleShare} className="w-full gradient-button text-white font-bold py-3 px-8 rounded-full">
                                    I've Shared It - Unlock My Quizzes!
                                </button>
                            </div>
                        </div>
                    )}
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        {preparedQuizzes.map((quiz, i) => {
                            const statusColors = { 'Completed': 'border-green-500', 'Unlocked': 'border-blue-500', 'Locked': 'border-gray-400', 'Requires Premium': 'border-amber-500' };
                            const buttonIcons = { 'Start Quiz': 'fa-arrow-right', 'Play Again': 'fa-redo', 'Unlock': 'fa-star', 'Unlock with Reward': 'fa-gift', 'Locked': 'fa-lock', 'Share to Unlock': 'fa-share-alt', 'Share to Unlock More': 'fa-share-alt' };
                            const isDisabled = quiz.status === 'Locked';
                            const showShareButton = quiz.buttonText.includes('Share');
                            
                            return (
                                <div key={quiz.day} className={`bg-white dark:bg-slate-900 p-6 rounded-2xl shadow-lg card-hover flex flex-col border-t-4 ${statusColors[quiz.status]} animate-slideInUp`} style={{animationDelay: `${i*50}ms`}}>
                                    <div className="flex-grow">
                                        <h3 className="text-xl font-bold text-gray-900 dark:text-white mb-2">Day {quiz.day}: {quiz.title}</h3>
                                        <p className="text-gray-600 dark:text-gray-400 mb-3">Subject: {quiz.subject}</p>
                                        <p className={`font-semibold mb-1 text-sm ${{ 'Completed': 'text-green-600 dark:text-green-400', 'Unlocked': 'text-blue-600 dark:text-blue-400', 'Locked': 'text-gray-500 dark:text-gray-400', 'Requires Premium': 'text-amber-600 dark:text-amber-400' }[quiz.status]}`}>Status: {quiz.status}</p>
                                        <p className="text-xs text-gray-500 dark:text-gray-400 mb-4">{quiz.statusText}</p>
                                        {quiz.isPremium && !isPremium && (
                                            <span className="inline-block bg-amber-100 dark:bg-amber-900/30 text-amber-800 dark:text-amber-200 text-xs px-2 py-1 rounded-full mb-2">
                                                <i className="fas fa-star mr-1"></i>Premium
                                            </span>
                                        )}
                                    </div>
                                    <button 
                                        onClick={showShareButton ? () => setShowShareModal(true) : () => handleQuizClick(quiz, quiz.status)} 
                                        disabled={isDisabled && !showShareButton}
                                        className={`w-full mt-auto font-bold py-2 px-4 rounded-full shadow-md text-sm transition-transform duration-200 ${
                                            !isDisabled || showShareButton ? 
                                            (showShareButton ? 'bg-green-500 hover:bg-green-600 text-white' : 'gradient-button text-white') 
                                            : 'bg-gray-300 dark:bg-slate-700 text-gray-500 dark:text-gray-400 cursor-not-allowed'
                                        }`}
                                    >
                                        <span>
                                            {quiz.buttonText} 
                                            <i className={`fas ${buttonIcons[quiz.buttonText] || 'fa-question-circle'} ml-2`}></i>
                                        </span>
                                    </button>
                                </div>
                            );
                        })}
                    </div>
                </div>
            </section>
        );
    };

    // =================================================================================
    // ===== SUBJECT MASTERY COMPONENT (RENAMED FROM TEST) =====
    // =================================================================================

    const Section = ({ title, subtitle, children }) => (
        <div className="container mx-auto px-4 py-8">
            {title && (
                <div className="text-center mb-8">
                    <h2 className="text-3xl font-bold text-slate-800 dark:text-white">{title}</h2>
                    {subtitle && <p className="text-slate-500 dark:text-slate-400 mt-2">{subtitle}</p>}
                </div>
            )}
            {children}
        </div>
    );

    const DonutChart = ({ percentage }) => {
        const size = 150; const strokeWidth = 15; const radius = (size - strokeWidth) / 2; const circumference = 2 * Math.PI * radius; const offset = circumference - (percentage / 100) * circumference;
        return (
            <div className="relative" style={{ width: size, height: size }}>
                <svg width={size} height={size} className="transform -rotate-90">
                    <circle className="text-slate-200 dark:text-slate-700" stroke="currentColor" strokeWidth={strokeWidth} fill="transparent" r={radius} cx={size / 2} cy={size / 2} />
                    <circle className="text-primary-500 text-green-500" stroke="currentColor" strokeWidth={strokeWidth} strokeDasharray={circumference} strokeDashoffset={offset} strokeLinecap="round" fill="transparent" r={radius} cx={size / 2} cy={size / 2} style={{ transition: 'stroke-dashoffset 0.5s ease-out' }} />
                </svg>
                <div className="absolute inset-0 flex items-center justify-center"> <span className="text-3xl font-bold text-slate-800 dark:text-white">{percentage}%</span> </div>
            </div>
        );
    };
    
    // Subject Mastery Component (Renamed from Test)
    const SubjectMasteryComponent = () => {
        const { useState, useEffect, useMemo, useRef } = React;
        const [view, setView] = useState('subject_select');
        const [activeSubject, setActiveSubject] = useState(null);
        const [activeQuizData, setActiveQuizData] = useState(null);
        const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
        const [userAnswers, setUserAnswers] = useState([]);
        const [timer, setTimer] = useState(15); // 15 seconds timer
        const [isTimeUp, setIsTimeUp] = useState(false);
        const timerRef = useRef(null);

        useEffect(() => {
            if (view === 'quiz') {
                timerRef.current = setInterval(() => {
                    setTimer(prev => {
                        if (prev === 1) {
                            clearInterval(timerRef.current);
                            setIsTimeUp(true);
                            setTimeout(() => {
                                handleNext(true);
                            }, 1500);
                            return 0;
                        }
                        return prev - 1;
                    });
                }, 1000);
            }
            return () => clearInterval(timerRef.current);
        }, [view, currentQuestionIndex]);
        
        const resetTimer = () => {
            clearInterval(timerRef.current);
            setTimer(15);
            setIsTimeUp(false);
        };
        
        const handleNext = (isTimeUp = false) => {
            resetTimer();
            if (currentQuestionIndex < activeQuizData.questions.length - 1) {
                setCurrentQuestionIndex(prev => prev + 1);
            } else {
                setView('results');
            }
        };

        const QuizResults = ({ quizData, userAnswers, onRestart, onSelectNew }) => {
            const { score, correctAnswers, wrongAnswers, percentage } = useMemo(() => {
                let correct = 0;
                quizData.questions.forEach((q, i) => { if (q.correctAnswer === userAnswers[i]) correct++; });
                const total = quizData.questions.length;
                return { score: correct, correctAnswers: correct, wrongAnswers: total - correct, percentage: total > 0 ? Math.round((correct / total) * 100) : 0 };
            }, [quizData, userAnswers]);
            
            // Smooth transition effect
            useEffect(() => {
                const timer = setTimeout(() => {
                    // Force re-render for smooth animation
                }, 100);
                return () => clearTimeout(timer);
            }, []);

            return (
                <div className="w-full max-w-4xl mx-auto animate-fadeIn">
                    <div className="bg-white dark:bg-slate-800 p-6 md:p-8 text-center rounded-lg shadow-lg transition-all duration-500 ease-in-out">
                        <h2 className="font-serif text-3xl font-bold text-slate-800 dark:text-white mb-2">Quiz Results</h2>
                        <p className="text-slate-500 dark:text-slate-400 mb-6">You completed the {quizData.title} quiz!</p>
                        <div className="my-8 flex flex-col md:flex-row items-center justify-center gap-8 transition-all duration-700">
                            <DonutChart percentage={percentage} />
                            <div className="flex gap-4 text-left animate-slideInUp">
                                <div className="bg-green-50 dark:bg-green-900/30 border border-green-200 dark:border-green-800/50 p-4 flex-1 rounded-lg transition-transform hover:scale-105"> 
                                    <div className="font-bold text-3xl text-green-600 dark:text-green-400">{correctAnswers}</div> 
                                    <div className="text-sm font-semibold text-green-800 dark:text-green-300">Correct</div> 
                                </div>
                                <div className="bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-800/50 p-4 flex-1 rounded-lg transition-transform hover:scale-105"> 
                                    <div className="font-bold text-3xl text-red-600 dark:text-red-400">{wrongAnswers}</div> 
                                    <div className="text-sm font-semibold text-red-800 dark:text-red-300">Incorrect</div> 
                                </div>
                                <div className="bg-blue-50 dark:bg-blue-900/30 border border-blue-200 dark:border-blue-800/50 p-4 flex-1 rounded-lg transition-transform hover:scale-105"> 
                                    <div className="font-bold text-3xl text-blue-600 dark:text-blue-400">{score}/{quizData.questions.length}</div> 
                                    <div className="text-sm font-semibold text-blue-800 dark:text-blue-300">Score</div> 
                                </div>
                            </div>
                        </div>
                        <div className="flex flex-col md:flex-row gap-4 justify-center mt-8 animate-fadeIn" style={{animationDelay: '200ms'}}>
                            <button onClick={onRestart} className="gradient-button px-8 py-3 rounded-full font-semibold transition-transform hover:scale-105">
                                <i className="fa-solid fa-redo mr-2"></i>Play Again
                            </button>
                            <button onClick={onSelectNew} className="px-8 py-3 rounded-full font-semibold bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 transition hover:scale-105">
                                Choose Another Quiz
                            </button>
                        </div>
                    </div>
                    <div className="bg-white dark:bg-slate-800 p-6 md:p-8 mt-6 text-left rounded-lg shadow-lg animate-fadeIn" style={{animationDelay: '400ms'}}>
                        <h3 className="font-serif text-2xl font-bold text-slate-800 dark:text-white mb-4">Review Answers</h3>
                        <div className="space-y-6">
                            {quizData.questions.map((q, i) => {
                                const userAnswer = userAnswers[i];
                                const isCorrect = q.correctAnswer === userAnswer;
                                return (
                                    <div key={i} className="border-b border-slate-200 dark:border-slate-700 pb-4 animate-fadeIn" style={{animationDelay: `${i * 100}ms`}}>
                                        <p className="font-semibold text-slate-800 dark:text-white">{i + 1}. {q.question}</p>
                                        <p className={`mt-2 text-sm ${isCorrect ? 'text-green-600 dark:text-green-400' : 'text-red-600 dark:text-red-400'}`}> 
                                            <i className={`fa-solid ${isCorrect ? 'fa-check-circle' : 'fa-times-circle'} mr-2`}></i> 
                                            Your answer: <span className="font-bold">{userAnswer || "Not answered"}</span> 
                                        </p>
                                        {!isCorrect && (
                                            <p className="mt-1 text-sm text-green-600 dark:text-green-400"> 
                                                <i className="fa-solid fa-check-circle mr-2"></i> 
                                                Correct answer: <span className="font-bold">{q.correctAnswer}</span> 
                                            </p>
                                        )}
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                </div>
            );
        };
        
        const startQuiz = (quizData) => { 
            setActiveQuizData(quizData); 
            setUserAnswers(Array(quizData.questions.length).fill(null)); 
            setCurrentQuestionIndex(0); 
            resetTimer(); 
            setView('quiz'); 
        };
        
        const generateMixedQuiz = (subject, numQuestions) => {
            const allQuestions = Object.values(DATA.quizzes[subject].chapters).flatMap(chapter => chapter.questions);
            for (let i = allQuestions.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [allQuestions[i], allQuestions[j]] = [allQuestions[j], allQuestions[i]]; }
            const selectedQuestions = allQuestions.slice(0, numQuestions);
            return { title: `Mixed ${subject} Quiz (${selectedQuestions.length} Qs)`, questions: selectedQuestions };
        };

        const handleAnswerSelect = (answer) => {
            if (userAnswers[currentQuestionIndex] !== null) return;
            const newAnswers = [...userAnswers];
            newAnswers[currentQuestionIndex] = answer;
            setUserAnswers(newAnswers);
        };

        if (view === 'results') { 
            return (
                <Section>
                    <QuizResults 
                        quizData={activeQuizData} 
                        userAnswers={userAnswers} 
                        onRestart={() => startQuiz(activeQuizData)} 
                        onSelectNew={() => setView('subject_select')} 
                    />
                </Section>
            ); 
        }
        
        if (view === 'quiz') {
            const currentQuestion = activeQuizData.questions[currentQuestionIndex];
            const timerColor = timer > 10 ? 'text-green-500' : timer > 5 ? 'text-yellow-500' : 'text-red-500';
            return (
                <Section>
                    <div className="w-full max-w-3xl mx-auto bg-white dark:bg-slate-800 p-6 md:p-8 rounded-2xl shadow-2xl animate-popIn relative overflow-hidden">
                        {isTimeUp && (
                            <div className="absolute inset-0 bg-red-800/80 backdrop-blur-sm flex flex-col justify-center items-center z-20 animate-popIn">
                                <i className="far fa-clock text-7xl text-white animate-tada"></i>
                                <h2 className="text-5xl font-extrabold text-white mt-4">Time's Up!</h2>
                            </div>
                        )}
                        <div className="flex justify-between items-center mb-4">
                            <h2 className="font-serif text-xl font-bold text-slate-800 dark:text-white">{activeQuizData.title}</h2>
                            <div className="flex items-center gap-4">
                                <div className={`flex items-center gap-2 font-bold text-lg ${timerColor} animate-pulse`}>
                                    <i className="far fa-clock"></i>
                                    <span>{timer}s</span>
                                </div>
                                <span className="font-semibold text-slate-500 dark:text-slate-400">{currentQuestionIndex + 1} / {activeQuizData.questions.length}</span>
                            </div>
                        </div>
                        <div className="w-full bg-slate-200 dark:bg-slate-700 rounded-full h-2.5 mb-6"> 
                            <div 
                                className="bg-indigo-600 h-2.5 rounded-full transition-all duration-300 ease-out" 
                                style={{ width: `${((currentQuestionIndex + 1) / activeQuizData.questions.length) * 100}%` }}
                            ></div> 
                        </div>
                        <h3 className="text-xl md:text-2xl font-semibold text-slate-900 dark:text-white mb-8 text-center min-h-[6rem] flex items-center justify-center animate-fadeIn">
                            {currentQuestion.question}
                        </h3>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            {currentQuestion.options.map(option => {
                                const isSelected = userAnswers[currentQuestionIndex] === option;
                                
                                let buttonClass = 'p-4 rounded-lg text-left font-semibold border-2 transition-all duration-300 ';
                                if(isSelected) {
                                   buttonClass += 'bg-indigo-500 border-indigo-500 text-white shadow-lg transform scale-105';
                                } else {
                                   buttonClass += 'bg-slate-100 dark:bg-slate-900/50 border-transparent hover:border-indigo-400 dark:hover:border-indigo-500 hover:scale-105';
                                }
                                return (
                                    <button 
                                        key={option} 
                                        onClick={() => handleAnswerSelect(option)} 
                                        disabled={userAnswers[currentQuestionIndex] !== null}
                                        className={buttonClass}
                                    >
                                        {option}
                                    </button>
                                );
                            })}
                        </div>
                        <div className="mt-8 text-right">
                             <button 
                                onClick={() => handleNext()} 
                                disabled={userAnswers[currentQuestionIndex] === null}
                                className="gradient-button px-10 py-3 rounded-lg font-semibold disabled:opacity-50 disabled:cursor-not-allowed transition-all hover:scale-105"
                            >
                                {currentQuestionIndex < activeQuizData.questions.length - 1 ? 'Next' : 'Finish'} 
                                <i className="fa-solid fa-arrow-right ml-2"></i>
                            </button>
                        </div>
                    </div>
                </Section>
            );
        }

        if (view === 'quiz_config') {
            const questionOptions = [10, 20, 30, 50];
            return (
                <Section title={`Configure Mixed ${activeSubject} Quiz`} subtitle="How many questions would you like?">
                    <div className="max-w-xl mx-auto text-center">
                        <div className="bg-white dark:bg-slate-800 p-6 grid grid-cols-2 gap-4 rounded-lg shadow-lg">
                            {questionOptions.map(num => (
                                <button 
                                    key={num} 
                                    onClick={() => startQuiz(generateMixedQuiz(activeSubject, num))} 
                                    className="gradient-button text-xl font-bold p-6 rounded-xl shadow-lg hover:shadow-2xl transition-all hover:scale-105"
                                >
                                    {num}
                                    <span className="block text-sm font-semibold opacity-80">Questions</span>
                                </button>
                            ))}
                        </div>
                        <button onClick={() => setView('chapter_select')} className="mt-8 text-sm font-semibold text-slate-500 hover:text-indigo-500 transition-colors">
                            <i className="fa-solid fa-arrow-left mr-2"></i>Back to Chapters 
                        </button>
                    </div>
                </Section>
            );
        }

        if (view === 'chapter_select') {
            const subjectData = DATA.quizzes[activeSubject];
            return (
                <Section title={`${activeSubject} Quizzes`} subtitle="Choose a chapter or try a mix of all chapters.">
                    <div className="max-w-2xl mx-auto">
                        <button 
                            onClick={() => setView('quiz_config')} 
                            className="w-full gradient-button text-lg font-semibold p-6 rounded-xl mb-6 shadow-lg hover:shadow-2xl transition-all hover:scale-105 text-left flex justify-between items-center"
                        >
                            <span><i className="fa-solid fa-random mr-3"></i>Mixed Chapter Quiz</span> 
                            <i className="fa-solid fa-arrow-right"></i> 
                        </button>
                        <div className="bg-white dark:bg-slate-800 p-6 space-y-3 rounded-lg shadow-lg">
                            {Object.entries(subjectData.chapters).map(([chapterTitle, chapterData]) => (
                                <button 
                                    key={chapterTitle} 
                                    onClick={() => startQuiz({ title: chapterTitle, questions: chapterData.questions })} 
                                    className="w-full text-left p-4 rounded-lg font-medium bg-slate-100 dark:bg-slate-900/50 hover:bg-slate-200 dark:hover:bg-slate-700 transition-all hover:scale-105 flex justify-between items-center"
                                >
                                    <span>{chapterTitle}</span> 
                                    <span className="text-xs font-semibold text-slate-500">{chapterData.questions.length} Questions</span> 
                                </button>
                            ))}
                        </div>
                        <button onClick={() => setView('subject_select')} className="mt-8 text-sm font-semibold text-slate-500 hover:text-indigo-500 transition-colors">
                            <i className="fa-solid fa-arrow-left mr-2"></i>Back to Subjects 
                        </button>
                    </div>
                </Section>
            );
        }

        return (
            <Section title="Subject Mastery" subtitle="Select a subject to test your knowledge and improve your skills.">
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    {Object.entries(DATA.quizzes).map(([subject, quizMeta]) => (
                        <div key={subject} className="bg-white dark:bg-slate-800 p-6 text-center rounded-2xl shadow-lg animate-slideInUp card-hover flex flex-col transition-all hover:scale-105">
                            <div className="h-20 w-20 mx-auto rounded-full bg-gradient-to-br from-indigo-200 to-purple-200 dark:from-indigo-900/40 dark:to-purple-900/40 grid place-items-center text-indigo-500 text-4xl mb-4"> 
                                <i className={quizMeta.icon}></i> 
                            </div>
                            <h3 className="font-serif text-2xl font-bold text-slate-800 dark:text-white">{subject}</h3>
                            <p className="text-slate-500 dark:text-slate-400 mt-1 mb-6 flex-grow">{quizMeta.title}</p>
                            <button 
                                onClick={() => { setActiveSubject(subject); setView('chapter_select'); }} 
                                className="gradient-button w-full px-6 py-3 rounded-lg font-semibold mt-auto transition-transform hover:scale-105"
                            >
                                Start Quiz 
                            </button>
                        </div>
                    ))}
                </div>
            </Section>
        );
    };

    // =================================================================================
    // ===== GOOD FRIDAY QUIZ COMPONENT =====
    // =================================================================================
    const GoodFridayQuiz = ({ isPremium, user, onShowReportCard }) => {
        const [quizState, setQuizState] = useState('waiting'); // waiting, active, completed
        const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
        const [userAnswers, setUserAnswers] = useState([]);
        const [timer, setTimer] = useState(15);
        const [showCorrectAnswer, setShowCorrectAnswer] = useState(false);
        const [selectedQuestions, setSelectedQuestions] = useState([]);
        
        const timerRef = useRef(null);

        // Check if it's Friday 7:00 PM
        useEffect(() => {
            const checkQuizTime = () => {
                const now = new Date();
                const isFriday = now.getDay() === 5; // 5 is Friday
                const is7PM = now.getHours() === 19; // 7 PM
                
                if (isFriday && is7PM && isPremium) {
                    setQuizState('active');
                    // Select 20 unique questions not used in last week's quiz
                    selectQuestions();
                }
            };
            
            checkQuizTime();
            const interval = setInterval(checkQuizTime, 60000); // Check every minute
            return () => clearInterval(interval);
        }, [isPremium]);

        const selectQuestions = () => {
            const lastWeekQuestions = getJSONFromLocalStorage('lastGoodFridayQuestions', []);
            const availableQuestions = DATA.goodFridayQuestions.filter(q => 
                !lastWeekQuestions.includes(q.question)
            );
            
            // Shuffle and select 20 questions
            const shuffled = [...availableQuestions].sort(() => 0.5 - Math.random());
            const selected = shuffled.slice(0, 20);
            setSelectedQuestions(selected);
            setUserAnswers(Array(20).fill(null));
            
            // Save for next week
            localStorage.setItem('lastGoodFridayQuestions', JSON.stringify(selected.map(q => q.question)));
        };

        useEffect(() => {
            if (quizState === 'active' && currentQuestionIndex < selectedQuestions.length) {
                setTimer(15);
                setShowCorrectAnswer(false);
                
                timerRef.current = setInterval(() => {
                    setTimer(prev => {
                        if (prev === 1) {
                            clearInterval(timerRef.current);
                            handleTimeUp();
                            return 0;
                        }
                        return prev - 1;
                    });
                }, 1000);
            }
            
            return () => clearInterval(timerRef.current);
        }, [quizState, currentQuestionIndex, selectedQuestions]);

        const handleTimeUp = () => {
            setShowCorrectAnswer(true);
            setTimeout(() => {
                if (currentQuestionIndex < selectedQuestions.length - 1) {
                    setCurrentQuestionIndex(prev => prev + 1);
                } else {
                    setQuizState('completed');
                    calculateResults();
                }
            }, 3000);
        };

        const handleAnswerSelect = (answer) => {
            if (userAnswers[currentQuestionIndex] !== null) return;
            
            const newAnswers = [...userAnswers];
            newAnswers[currentQuestionIndex] = answer;
            setUserAnswers(newAnswers);
            
            setShowCorrectAnswer(true);
            clearInterval(timerRef.current);
            
            setTimeout(() => {
                if (currentQuestionIndex < selectedQuestions.length - 1) {
                    setCurrentQuestionIndex(prev => prev + 1);
                } else {
                    setQuizState('completed');
                    calculateResults();
                }
            }, 3000);
        };

        const calculateResults = () => {
            let score = 0;
            selectedQuestions.forEach((question, index) => {
                if (userAnswers[index] === question.correctAnswer) {
                    score++;
                }
            });
            
            onShowReportCard(score, selectedQuestions.length);
        };

        if (quizState === 'waiting') {
            return (
                <div className="text-center p-8 bg-white dark:bg-slate-800 rounded-2xl shadow-lg">
                    <h3 className="text-2xl font-bold text-indigo-600 dark:text-indigo-400 mb-4">Good Friday Quiz</h3>
                    <p className="text-gray-600 dark:text-gray-400 mb-4">
                        {isPremium 
                            ? "The quiz starts every Friday at 7:00 PM. Come back then to participate!"
                            : "This quiz is available for premium users only. Upgrade to participate!"
                        }
                    </p>
                    {!isPremium && (
                        <button className="gradient-button text-white font-bold py-2 px-6 rounded-full">
                            Upgrade to Premium
                        </button>
                    )}
                </div>
            );
        }

        if (quizState === 'active' && selectedQuestions.length > 0) {
            const currentQuestion = selectedQuestions[currentQuestionIndex];
            const timerColor = timer > 10 ? 'text-green-500' : timer > 5 ? 'text-yellow-500' : 'text-red-500';

            return (
                <div className="w-full max-w-3xl mx-auto bg-white dark:bg-slate-800 p-6 md:p-8 rounded-2xl shadow-2xl">
                    <div className="flex justify-between items-center mb-4">
                        <h2 className="font-serif text-xl font-bold text-slate-800 dark:text-white">Good Friday Quiz</h2>
                        <div className="flex items-center gap-4">
                            <div className={`flex items-center gap-2 font-bold text-lg ${timerColor} animate-pulse`}>
                                <i className="far fa-clock"></i>
                                <span>{timer}s</span>
                            </div>
                            <span className="font-semibold text-slate-500 dark:text-slate-400">
                                {currentQuestionIndex + 1} / {selectedQuestions.length}
                            </span>
                        </div>
                    </div>
                    
                    <div className="w-full bg-slate-200 dark:bg-slate-700 rounded-full h-2.5 mb-6">
                        <div 
                            className="bg-indigo-600 h-2.5 rounded-full transition-all duration-300" 
                            style={{ width: `${((currentQuestionIndex + 1) / selectedQuestions.length) * 100}%` }}
                        ></div>
                    </div>

                    <h3 className="text-xl md:text-2xl font-semibold text-slate-900 dark:text-white mb-8 text-center">
                        {currentQuestion.question}
                    </h3>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        {currentQuestion.options.map(option => {
                            const isSelected = userAnswers[currentQuestionIndex] === option;
                            const isCorrect = option === currentQuestion.correctAnswer;
                            
                            let buttonClass = 'p-4 rounded-lg text-left font-semibold border-2 transition-all duration-300 ';
                            
                            if (showCorrectAnswer) {
                                if (isCorrect) {
                                    buttonClass += 'bg-green-500 border-green-500 text-white shadow-lg';
                                } else if (isSelected) {
                                    buttonClass += 'bg-red-500 border-red-500 text-white shadow-lg';
                                } else {
                                    buttonClass += 'bg-gray-200 dark:bg-slate-700 border-gray-300 dark:border-slate-600 opacity-50';
                                }
                            } else {
                                if (isSelected) {
                                    buttonClass += 'bg-indigo-500 border-indigo-500 text-white shadow-lg';
                                } else {
                                    buttonClass += 'bg-slate-100 dark:bg-slate-900/50 border-transparent hover:border-indigo-400 dark:hover:border-indigo-500';
                                }
                            }
                            
                            return (
                                <button
                                    key={option}
                                    onClick={() => handleAnswerSelect(option)}
                                    disabled={showCorrectAnswer}
                                    className={buttonClass}
                                >
                                    {option}
                                </button>
                            );
                        })}
                    </div>

                    {showCorrectAnswer && (
                        <div className="mt-6 p-4 bg-blue-50 dark:bg-blue-900/30 rounded-lg text-center animate-fadeIn">
                            <p className="text-blue-700 dark:text-blue-300 font-semibold">
                                Correct answer: <span className="text-green-600 dark:text-green-400">{currentQuestion.correctAnswer}</span>
                            </p>
                        </div>
                    )}
                </div>
            );
        }

        return null;
    };

    // --- The main, updated competition section component ---
    const QuizCompetitionSection = ({ isPremium, onSetUserName, unlockedAchievements, checkAndUnlockAchievement, onShowPremiumCert, onShowCompletionCert, userStats }) => {
        const [activeTab, setActiveTab] = useState('quiz');
        const [user, setUser] = useState(null);
        const [showModal, setShowModal] = useState(false);
        const [error, setError] = useState(null);
        const [quizStatus, setQuizStatus] = useState({ isActive: false, countdown: 'Loading...', nextQuizDay: '' });
        const [showWinnerCertificate, setShowWinnerCertificate] = useState(null);
        const [podiumStats, setPodiumStats] = useState({ first: 0, second: 0, third: 0 });
        const [showGoodFridayReport, setShowGoodFridayReport] = useState(false);
        const [goodFridayScore, setGoodFridayScore] = useState(0);

        useEffect(() => {
            const storedUser = getJSONFromLocalStorage('quizHubUser', null);
            if (storedUser) {
                setUser(storedUser); 
                const history = getJSONFromLocalStorage('userPodiumHistory', []); 
                const fourMonthsAgo = new Date(); 
                fourMonthsAgo.setMonth(fourMonthsAgo.getMonth() - 4);
                const recentHistory = history.filter(h => new Date(h.date) >= fourMonthsAgo);
                const stats = recentHistory.reduce((acc, h) => { 
                    if (h.rank === 1) acc.first++; 
                    else if (h.rank === 2) acc.second++; 
                    else if (h.rank === 3) acc.third++; 
                    return acc; 
                }, { first: 0, second: 0, third: 0 });
                setPodiumStats(stats);
                if (stats.first + stats.second + stats.third >= 3) { 
                    checkAndUnlockAchievement('THREE_WINS'); 
                }
                const seenResultKey = `seenCompResult_${DATA.competitionResults.date}`;
                if (!localStorage.getItem(seenResultKey)) {
                    const winnerInfo = DATA.competitionResults.podium.find(p => p.symbol === storedUser.symbol);
                    if (winnerInfo) { 
                        setShowWinnerCertificate(winnerInfo); 
                        localStorage.setItem(seenResultKey, 'true'); 
                        const isAlreadyRecorded = history.some(h => h.date === DATA.competitionResults.date); 
                        if (!isAlreadyRecorded) { 
                            history.push({ date: DATA.competitionResults.date, rank: winnerInfo.rank, score: winnerInfo.score }); 
                            localStorage.setItem('userPodiumHistory', JSON.stringify(history)); 
                        } 
                    }
                }
            } else { 
                setShowModal(true); 
            }
        }, []);

        const handleJoin = (e) => { 
            e.preventDefault(); 
            setError(null); 
            const name = e.target.elements.userName.value; 
            const symbol = e.target.elements.symbolNumber.value; 
            if (DATA.validSymbolNumbers.includes(symbol)) { 
                const newUser = { name, symbol }; 
                localStorage.setItem('quizHubUser', JSON.stringify(newUser)); 
                onSetUserName(name); 
                setUser(newUser); 
                setShowModal(false); 
            } else { 
                setError({ message: `Invalid Symbol Number.` }); 
            } 
        };
        
        useEffect(() => { 
            const quizDays = [1, 3, 6]; 
            const quizStartHour = 20; 
            const dayNames = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"]; 
            const calculateQuizState = () => { 
                const now = new Date(); 
                const currentDay = now.getDay(); 
                const currentHour = now.getHours(); 
                for (const quizDay of quizDays) { 
                    if (currentDay === quizDay && currentHour >= quizStartHour) { 
                        setQuizStatus({ isActive: true, countdown: 'Live Now!', nextQuizDay: '' }); 
                        return; 
                    } 
                } 
                let nextQuizDate = new Date(now); 
                nextQuizDate.setHours(quizStartHour, 0, 0, 0); 
                let nextDay = -1; 
                for (const quizDay of quizDays) { 
                    if (quizDay > currentDay || (quizDay === currentDay && currentHour < quizStartHour)) { 
                        nextDay = quizDay; 
                        break; 
                    } 
                } 
                if (nextDay !== -1) { 
                    nextQuizDate.setDate(now.getDate() + (nextDay - currentDay)); 
                } else { 
                    nextDay = quizDays[0]; 
                    nextQuizDate.setDate(now.getDate() + (7 - currentDay + nextDay)); 
                } 
                const diff = nextQuizDate.getTime() - now.getTime(); 
                const d = Math.floor(diff / (1000 * 60 * 60 * 24)); 
                const h = Math.floor((diff / (1000 * 60 * 60)) % 24); 
                const m = Math.floor((diff / 1000 / 60) % 60); 
                const s = Math.floor((diff / 1000) % 60); 
                setQuizStatus({ isActive: false, countdown: `${d}d:${h.toString().padStart(2,'0')}h:${m.toString().padStart(2,'0')}m:${s.toString().padStart(2,'0')}s`, nextQuizDay: dayNames[nextDay] }); 
            }; 
            calculateQuizState(); 
            const timer = setInterval(calculateQuizState, 1000); 
            return () => clearInterval(timer); 
        }, []);
        
        const handleDownload = () => { 
            if (!isPremium) { 
                alert("This is a premium feature."); 
                return; 
            } 
            const element = document.getElementById('results-to-download'); 
            if (element) { 
                html2canvas(element, { backgroundColor: '#111827', useCORS: true }).then(canvas => { 
                    const link = document.createElement('a'); 
                    link.download = `results-${DATA.competitionResults.date}.png`; 
                    link.href = canvas.toDataURL('image/png'); 
                    link.click(); 
                }); 
            } 
        };
        
        const renderUserHighlight = (text) => `${text} <span class="text-yellow-400 font-bold">(You)</span>`;
        
        const handleGoodFridayReport = (score, total) => {
            setGoodFridayScore(score);
            setShowGoodFridayReport(true);
        };

        const TABS = ['quiz', 'results', 'goodfriday', 'subjectmastery', 'profile'];

        return (
            <section id="competition" className="py-12 px-4 md:px-8 bg-gray-50 dark:bg-slate-800">
                {showWinnerCertificate && <WinnerCertificateModal winnerInfo={showWinnerCertificate} onClose={() => setShowWinnerCertificate(null)} />}
                {showGoodFridayReport && (
                    <GoodFridayReportCard 
                        user={user} 
                        score={goodFridayScore} 
                        totalQuestions={20}
                        onClose={() => setShowGoodFridayReport(false)}
                        onShare={() => {}} 
                    />
                )}
                <div className="container mx-auto">
                    <header className="text-center p-8 md:p-12 text-white rounded-2xl shadow-xl relative overflow-hidden bg-gradient-to-br from-indigo-700 via-purple-700 to-blue-800 animate-gradient"> 
                        <div className="relative z-10">
                            {user && <p className="absolute top-4 left-4 text-sm bg-black/30 px-3 py-1 rounded-full">Welcome, <span className="font-bold text-yellow-300">{user.name}</span> ({user.symbol})</p>}
                            <h1 className="text-3xl md:text-5xl font-extrabold mb-2 animate-popIn">Competition Hub</h1>
                            <p className="text-lg md:text-xl opacity-90">Test your skills, climb the leaderboard, and earn achievements.</p>
                        </div>
                    </header>
                    {user ? ( 
                        <div>
                            <div className="flex flex-wrap justify-center my-6 bg-white dark:bg-slate-900 rounded-xl shadow-md p-2">
                                {TABS.map(tab => (
                                    <button 
                                        key={tab} 
                                        onClick={() => setActiveTab(tab)} 
                                        className={`capitalize px-4 py-2 md:px-8 md:py-3 font-semibold rounded-lg transition-all duration-300 ${
                                            activeTab === tab ? 'bg-indigo-600 text-white shadow' : 'text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-slate-700'
                                        }`}
                                    >
                                        {tab === 'subjectmastery' ? 'Subject Mastery' : 
                                         tab === 'goodfriday' ? 'Good Friday' : tab}
                                    </button>
                                ))}
                            </div>
                            <div className="bg-white dark:bg-slate-900 rounded-2xl shadow-lg p-4 md:p-8 animate-fadeIn">
                                {activeTab === 'quiz' && ( 
                                    <div className="text-center bg-gradient-to-br from-gray-900 to-slate-800 p-8 md:p-12 rounded-2xl shadow-2xl border border-indigo-500/30">
                                        <h2 className="text-3xl md:text-4xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-indigo-400 to-purple-400 mb-4 animate-fadeIn">Weekly Quiz Challenge</h2>
                                        {quizStatus.isActive ? ( 
                                            <div className="animate-popIn">
                                                <p className="text-xl mb-6 text-green-400 font-semibold animate-pulse">The quiz is LIVE now!</p>
                                                <a href="#" target="_blank" rel="noopener noreferrer" className="gradient-button inline-block text-white font-bold py-4 px-12 rounded-full shadow-lg text-lg uppercase tracking-wide transform hover:scale-105 transition-transform duration-300"> Join Live Quiz </a> 
                                            </div> 
                                        ) : ( 
                                            <div className="animate-fadeIn">
                                                <p className="text-lg text-slate-300 mb-2">Next quiz on <span className="font-bold text-indigo-400">{quizStatus.nextQuizDay} at 8 PM</span>.</p>
                                                <div className="font-mono text-4xl md:text-6xl font-bold tracking-tight text-white my-6 bg-black/30 py-4 px-2 rounded-xl inline-block shadow-inner"> {quizStatus.countdown} </div>
                                                <button disabled className="gradient-button inline-block text-white font-bold py-4 px-12 rounded-full shadow-lg text-lg uppercase tracking-wide opacity-50 cursor-not-allowed"> 
                                                    <i className="fas fa-lock mr-3"></i>Quiz Locked 
                                                </button> 
                                            </div> 
                                        )} 
                                    </div> 
                                )}
                                {activeTab === 'results' && (
                                    <div>
                                        <div className="flex flex-col sm:flex-row justify-between items-center mb-6 gap-4">
                                            <div>
                                                <h2 className="text-2xl md:text-3xl font-bold text-indigo-600 dark:text-indigo-400">Latest Quiz Results</h2>
                                                <p className="text-gray-500 dark:text-gray-400">Results for: {DATA.competitionResults.date}</p>
                                            </div>
                                            <button onClick={handleDownload} disabled={!isPremium} className="gradient-button text-white font-bold py-2 px-4 rounded-full shadow-md text-sm disabled:opacity-50 flex-shrink-0">
                                                <i className={`fas ${isPremium ? 'fa-download' : 'fa-lock'} mr-2`}></i> Download
                                            </button>
                                        </div>
                                        <div className="my-8 bg-gray-100 dark:bg-slate-800 rounded-2xl p-6"> 
                                            <h3 className="text-2xl font-bold text-center text-indigo-600 dark:text-indigo-400 mb-4">Your Podium Stats (Last 4 Months)</h3> 
                                            <div className="flex justify-around text-center"> 
                                                <div className="px-2">
                                                    <p className="text-4xl font-bold text-amber-500">{podiumStats.first}</p>
                                                    <p className="font-semibold text-gray-600 dark:text-gray-400">ðŸ† 1st</p>
                                                </div> 
                                                <div className="px-2">
                                                    <p className="text-4xl font-bold text-slate-500">{podiumStats.second}</p>
                                                    <p className="font-semibold text-gray-600 dark:text-gray-400">ðŸ¥ˆ 2nd</p>
                                                </div> 
                                                <div className="px-2">
                                                    <p className="text-4xl font-bold text-orange-600">{podiumStats.third}</p>
                                                    <p className="font-semibold text-gray-600 dark:text-gray-400">ðŸ¥‰ 3rd</p>
                                                </div> 
                                            </div> 
                                        </div>
                                        <div className="flex flex-col md:flex-row justify-center items-end gap-4 md:gap-8 mb-8 text-center">
                                            {DATA.competitionResults.podium.map(p => (
                                                <div key={p.rank} className={`p-4 rounded-xl card-hover ${p.rank === 1 ? 'order-first md:order-2' : p.rank === 2 ? 'order-2 md:order-1' : 'order-last md:order-3'}`}>
                                                    <span className="text-4xl">{p.medal}</span>
                                                    <img src={p.img} alt={p.name} className={`w-24 h-24 md:w-32 md:h-32 rounded-full mx-auto my-2 object-cover border-4 border-${p.color}-400 shadow-lg`}/>
                                                    <p className="font-bold text-lg" dangerouslySetInnerHTML={{__html: user?.symbol === p.symbol ? renderUserHighlight(p.name) : p.name}}></p>
                                                    <p className="text-gray-500 dark:text-gray-400">{p.symbol}</p>
                                                    <p className="text-gray-600 dark:text-gray-400">{p.score}</p>
                                                </div>
                                            ))}
                                        </div>
                                        <div className="overflow-x-auto">
                                            <table className="w-full text-left">
                                                <thead className="bg-gray-100 dark:bg-slate-800">
                                                    <tr>
                                                        <th className="p-3">Rank</th>
                                                        <th className="p-3">Name</th>
                                                        <th className="p-3">Symbol</th>
                                                        <th className="p-3">Score</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {DATA.competitionResults.table.map(r => (
                                                        <tr key={r.rank}>
                                                            <td className="p-3">{r.rank}</td>
                                                            <td className="p-3" dangerouslySetInnerHTML={{__html: user?.symbol === r.symbol ? renderUserHighlight(r.name) : r.name}}></td>
                                                            <td className="p-3">{r.symbol}</td>
                                                            <td className="p-3">{r.score}</td>
                                                        </tr>
                                                    ))}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                )}
                                {activeTab === 'goodfriday' && (
                                    <GoodFridayQuiz 
                                        isPremium={isPremium} 
                                        user={user}
                                        onShowReportCard={handleGoodFridayReport}
                                    />
                                )}
                                {activeTab === 'subjectmastery' && ( 
                                    <SubjectMasteryComponent /> 
                                )}
                                {activeTab === 'profile' && (
                                    <ProfileSection 
                                        userStats={userStats}
                                        completedQuizzes={{}}
                                        unlockedAchievements={unlockedAchievements}
                                        onClose={() => setActiveTab('quiz')}
                                    />
                                )}
                            </div>
                        </div> 
                    ) : ( 
                        <div className="text-center p-8 mt-6 bg-white dark:bg-slate-900 rounded-2xl shadow-lg"> 
                            <h2 className="text-3xl font-bold">Join the Competition!</h2> 
                            {error ? <p className="mt-2 text-red-500">{error.message}</p> : <p className="mt-2 text-gray-600 dark:text-gray-400">Log in with your details to participate in live quizzes and see your rank.</p>} 
                            <button onClick={() => setShowModal(true)} className="gradient-button text-white font-bold py-3 px-8 rounded-full shadow-lg text-lg mt-6">Log In Now</button> 
                        </div> 
                    )}
                    {showModal && !user && (
                        <div className="overlay">
                            <div className="modal-box glassmorphism text-white relative">
                                <button onClick={() => setShowModal(false)} className="absolute top-2 right-3 text-white/50 hover:text-white text-2xl font-bold">&times;</button>
                                <div>
                                    <h3 className="text-2xl font-bold mb-2">Join the Competition!</h3>
                                    <p className="mb-4 text-white/80">Enter your details to participate and appear on the leaderboard.</p>
                                    <form onSubmit={handleJoin} className="flex flex-col gap-3">
                                        <input type="text" name="userName" placeholder="Your Name" required className="p-3 border-0 rounded-md bg-white/20 placeholder-white/60 text-white focus:ring-2 focus:ring-indigo-400 focus:outline-none" />
                                        <input type="text" name="symbolNumber" placeholder="Symbol Number" required className="p-3 border-0 rounded-md bg-white/20 placeholder-white/60 text-white focus:ring-2 focus:ring-indigo-400 focus:outline-none" />
                                        {error && <p className="text-red-400 text-sm -mb-1">{error.message}</p>}
                                        <button type="submit" className="gradient-button text-white font-bold py-2 px-6 rounded-full shadow-md mt-2">Join Now</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            </section>
        );
    };
    
    const PremiumLockOverlay = ({ onStartTrial, onUnlock, hasUsedTrial, isTrialActive, timeLeft }) => { 
        const formatTime = (ms) => { 
            if (ms <= 0) return "00:00"; 
            const totalSeconds = Math.floor(ms / 1000); 
            const minutes = Math.floor(totalSeconds / 60).toString().padStart(2, '0'); 
            const seconds = (totalSeconds % 60).toString().padStart(2, '0'); 
            return `${minutes}:${seconds}`; 
        }; 
        return ( 
            <div className="absolute inset-0 bg-white/50 dark:bg-slate-900/50 backdrop-blur-md z-20 flex flex-col justify-center items-center rounded-2xl p-4 text-center"> 
                {isTrialActive ? ( 
                    <Fragment> 
                        <div className="animate-pulse flex items-center gap-3 text-2xl font-bold text-slate-800 dark:text-white mb-2"> 
                            <i className="fas fa-eye text-green-500"></i> Free Preview Active 
                        </div> 
                        <p className="text-slate-600 dark:text-slate-300 mb-4">Time Remaining:</p> 
                        <div className="font-mono text-4xl font-extrabold text-slate-900 dark:text-white tracking-wider">{formatTime(timeLeft)}</div> 
                    </Fragment> 
                ) : ( 
                    <Fragment> 
                        <i className="fas fa-lock text-5xl text-amber-500 mb-4"></i> 
                        <h4 className="text-2xl font-bold text-slate-800 dark:text-white">Premium Content Locked</h4> 
                        <p className="text-slate-600 dark:text-slate-300 my-2 max-w-sm"> 
                            {hasUsedTrial ? "Your free preview has ended. Unlock permanently to get full access." : "Get a 15-minute free preview to explore all premium materials, or unlock them permanently." } 
                        </p> 
                        <div className="flex flex-col sm:flex-row gap-4 mt-4"> 
                            {!hasUsedTrial && ( 
                                <button onClick={onStartTrial} className="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-6 rounded-full shadow-md transition-transform hover:scale-105"> 
                                    Start 15-Min Preview 
                                </button> 
                            )} 
                            <button onClick={onUnlock} className="gradient-button text-white font-bold py-2 px-6 rounded-full shadow-md"> 
                                Get Premium Access 
                            </button> 
                        </div> 
                    </Fragment> 
                )} 
            </div> 
        ); 
    };
    
    const ResourcesSection = ({ isPremium, onPremiumUnlock, userName, checkAndUnlockAchievement }) => { 
        const [searchTerm, setSearchTerm] = useState(''); 
        const [activeTag, setActiveTag] = useState('all'); 
        const [showPaymentModal, setShowPaymentModal] = useState(false); 
        const [pdfToView, setPdfToView] = useState(null); 
        const [trialState, setTrialState] = useState({ hasUsedTrial: false, isTrialActive: false, timeLeft: 0 });
        const [showHelpNote, setShowHelpNote] = useState(false);
        const questionWhatsAppLink = `https://wa.me/${DATA.whatsAppContactNumber}?text=${encodeURIComponent(`Hello! I'm a premium member of the Balen Prep Portal and I have a question. My name is ${userName}.`)}`; 
        
        useEffect(() => { 
            const hasUsed = getJSONFromLocalStorage('balenHasUsedTrial', false); 
            const endTime = getJSONFromLocalStorage('balenTrialEndTime', null); 
            let intervalId; 
            if (endTime && Date.now() < endTime) { 
                const updateTimer = () => { 
                    const remaining = endTime - Date.now(); 
                    if (remaining > 0) { 
                        setTrialState({ hasUsedTrial: true, isTrialActive: true, timeLeft: remaining }); 
                    } else { 
                        setTrialState({ hasUsedTrial: true, isTrialActive: false, timeLeft: 0 }); 
                        localStorage.removeItem('balenTrialEndTime'); 
                        clearInterval(intervalId); 
                    } 
                }; 
                updateTimer(); 
                intervalId = setInterval(updateTimer, 1000); 
            } else { 
                setTrialState({ hasUsedTrial: hasUsed, isTrialActive: false, timeLeft: 0 }); 
            } 
            return () => clearInterval(intervalId); 
        }, []); 
        
        const handleStartTrial = () => { 
            const FIFTEEN_MINUTES_MS = 15 * 60 * 1000; 
            const endTime = Date.now() + FIFTEEN_MINUTES_MS; 
            localStorage.setItem('balenHasUsedTrial', JSON.stringify(true)); 
            localStorage.setItem('balenTrialEndTime', JSON.stringify(endTime)); 
            window.location.reload(); 
        }; 
        
        const allTags = useMemo(() => { 
            const tags = new Set(); 
            DATA.resources.forEach(cat => cat.items.forEach(item => item.tags.forEach(tag => tags.add(tag)))); 
            return ['all', ...Array.from(tags).sort()]; 
        }, []); 
        
        const filteredResources = useMemo(() => { 
            return DATA.resources.map(category => ({ ...category, items: category.items.filter(item => { const matchesTag = activeTag === 'all' || item.tags.includes(activeTag); const matchesSearch = item.title.toLowerCase().includes(searchTerm.toLowerCase()); return matchesTag && matchesSearch; }) })).filter(category => category.items.length > 0); 
        }, [searchTerm, activeTag]); 
        
        const getEmbedUrl = (url) => { 
            if (!url) return null; 
            const fileIdMatch = url.match(/drive\.google\.com\/(?:file\/d\/|drive\/folders\/)([a-zA-Z0-9_-]+)/); 
            if (url.includes('/folders/')) return null; 
            return fileIdMatch ? `https://drive.google.com/file/d/${fileIdMatch[1]}/preview` : null; 
        }; 
        
        return ( 
            <section id="resources" className="py-12 px-4 md:px-8 bg-gray-50 dark:bg-slate-800"> 
                {pdfToView && <PdfViewerModal pdfInfo={pdfToView} onClose={() => setPdfToView(null)} checkAndUnlockAchievement={checkAndUnlockAchievement} />} 
                {showPaymentModal && <PaymentModal onPaymentSuccess={onPremiumUnlock} onClose={() => setShowPaymentModal(false)} userName={userName}/>}
                {showHelpNote && <HelpNoteModal onClose={() => setShowHelpNote(false)} />}
                <div className="container mx-auto"> 
                    <div className="flex justify-between items-center mb-6">
                        <h2 className="text-4xl font-extrabold text-red-500 dark:text-red-400 animate-fadeIn">Study Resources</h2>
                        <button 
                            onClick={() => setShowHelpNote(true)}
                            className="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-full shadow-md transition-transform hover:scale-105"
                        >
                            <i className="fas fa-question-circle mr-2"></i>Help Note
                        </button>
                    </div>
                    <p className="text-center text-lg text-gray-600 dark:text-gray-400 max-w-2xl mx-auto mb-12">Your complete library for exam success.</p> 
                    {!isPremium ? ( 
                        <div className="text-center bg-gradient-to-r from-orange-500 to-amber-400 text-white p-6 rounded-2xl shadow-xl animate-popIn">
                            <h4 className="text-3xl md:text-4xl font-extrabold mb-2">Unlock Your Full Potential!</h4>
                            <div className="max-w-2xl mx-auto mt-4 text-left space-y-2 px-4">
                                <p className="flex items-start"><i className="fas fa-check-circle text-green-300 mt-1 mr-3"></i><span><strong>Full Access:</strong> Get all exclusive books, notes, and past papers.</span></p>
                                <p className="flex items-start"><i className="fas fa-check-circle text-green-300 mt-1 mr-3"></i><span><strong>Unlimited Quizzes:</strong> Unlock all premium quizzes instantly.</span></p>
                                <p className="flex items-start"><i className="fas fa-check-circle text-green-300 mt-1 mr-3"></i><span><strong>Downloadable Content:</strong> Download competition results and certificates.</span></p>
                                <p className="flex items-start"><i className="fas fa-check-circle text-green-300 mt-1 mr-3"></i><span><strong>One-Time Payment:</strong> Pay once, enjoy lifetime access.</span></p>
                            </div>
                            <div className="flex flex-col sm:flex-row justify-center items-center gap-4 mt-6">
                                <a href={DATA.premiumInfoVideoLink} target="_blank" rel="noopener noreferrer" className="bg-white text-blue-700 font-bold py-3 px-8 rounded-full shadow-lg text-lg uppercase tracking-wide hover:bg-gray-100 transition-colors duration-300">What is this? <i className="fab fa-youtube ml-2"></i></a>
                                <button onClick={() => setShowPaymentModal(true)} className="gradient-button inline-block text-white font-bold py-3 px-8 rounded-full shadow-lg text-lg uppercase tracking-wide">Get Premium Now <i className="fas fa-key ml-2"></i></button>
                            </div>
                        </div> 
                    ) : ( 
                        <div className="text-center bg-gradient-to-r from-green-500 to-emerald-400 text-white p-6 rounded-2xl shadow-xl animate-popIn">
                            <h4 className="text-3xl md:text-4xl font-extrabold mb-2">Premium Access Activated!</h4>
                            <p className="max-w-2xl mx-auto mt-4">You have full access to all resources. If you have any questions, feel free to reach out.</p>
                            <a href={questionWhatsAppLink} target="_blank" rel="noopener noreferrer" className="mt-6 inline-block bg-white text-green-700 font-bold py-3 px-8 rounded-full shadow-lg text-lg uppercase tracking-wide hover:bg-gray-100 transition-colors duration-300">Ask a Question <i className="fab fa-whatsapp ml-2"></i></a>
                        </div> 
                    )} 
                    <div className="sticky top-[80px] z-40 bg-gray-50/80 dark:bg-slate-800/80 backdrop-blur-sm p-4 my-8 rounded-xl shadow-md"> 
                        <div className="flex flex-col md:flex-row gap-4"> 
                            <div className="relative flex-grow"> 
                                <i className="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"></i> 
                                <input type="text" placeholder="Search resources..." value={searchTerm} onChange={e => setSearchTerm(e.target.value)} className="w-full pl-12 pr-4 py-3 rounded-full border-2 border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-900 focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition" /> 
                            </div> 
                            <div className="flex-shrink-0 flex items-center gap-2 overflow-x-auto pb-2"> 
                                {allTags.map(tag => ( 
                                    <button key={tag} onClick={() => setActiveTag(tag)} className={`px-4 py-2 rounded-full font-semibold text-sm whitespace-nowrap transition-all ${activeTag === tag ? 'bg-indigo-600 text-white shadow' : 'bg-gray-200 dark:bg-slate-700 hover:bg-gray-300 dark:hover:bg-slate-600'}`}> 
                                        {tag.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase())} 
                                    </button> 
                                ))} 
                            </div> 
                        </div> 
                    </div> 
                    {filteredResources.length > 0 ? filteredResources.map((cat, idx) => { 
                        const isPremiumCategory = cat.category === "Premium Materials"; 
                        const isLocked = !isPremium && isPremiumCategory && !trialState.isTrialActive; 
                        return ( 
                            <div key={idx} className="mb-12"> 
                                <h3 className="text-3xl font-bold text-indigo-700 dark:text-indigo-300 mb-6 border-b-2 border-indigo-200 dark:border-indigo-800 pb-2">{cat.category}</h3> 
                                <div className="relative"> 
                                    {isLocked && <PremiumLockOverlay onStartTrial={handleStartTrial} onUnlock={() => setShowPaymentModal(true)} hasUsedTrial={trialState.hasUsedTrial} isTrialActive={trialState.isTrialActive} timeLeft={trialState.timeLeft} />} 
                                    <div className={`grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 ${isLocked ? 'blur-sm pointer-events-none' : ''}`}> 
                                        {cat.items.map((item, j) => { 
                                            const isViewable = !!getEmbedUrl(item.link); 
                                            return ( 
                                                <div key={j} className="bg-white dark:bg-slate-900 p-6 rounded-2xl shadow-lg card-hover animate-slideInUp" style={{animationDelay: `${j * 50}ms`}}> 
                                                    <h4 className="flex items-start text-xl font-semibold text-gray-900 dark:text-white mb-4"> 
                                                        <i className={`${getIconForResource(item.tags)} mr-3 text-indigo-400 mt-1`}></i> 
                                                        <span>{item.title}</span> 
                                                    </h4> 
                                                    {isViewable ? ( 
                                                        <button onClick={() => setPdfToView({ url: item.link, title: item.title })} className="inline-block bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-full shadow-md text-sm" disabled={isLocked} > 
                                                            View Securely <i className="fas fa-eye ml-2"></i> 
                                                        </button> 
                                                    ) : ( 
                                                        <a href={item.link} target="_blank" rel="noopener noreferrer" className="inline-block gradient-button text-white font-bold py-2 px-4 rounded-full shadow-md text-sm" > 
                                                            Access / Download <i className="fas fa-external-link-alt ml-2"></i> 
                                                        </a> 
                                                    )} 
                                                </div> 
                                            ); 
                                        })} 
                                    </div> 
                                </div> 
                            </div> 
                        )}) : ( 
                        <div className="text-center py-16"> 
                            <p className="text-2xl font-bold">No resources found.</p> 
                            <p className="text-gray-500 mt-2">Try adjusting your search or filter.</p> 
                        </div> 
                    )} 
                </div> 
            </section> 
        ); 
    };
    
    const VideosSection = () => ( <section id="videos" className="py-12 px-4 md:px-8 bg-gray-50 dark:bg-slate-800"><div className="container mx-auto"><h2 className="text-4xl font-extrabold text-center text-red-500 dark:text-red-400 mb-10 animate-fadeIn">Informative Videos</h2><div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">{DATA.videos.map((video, idx) => (<div key={idx} className="bg-white dark:bg-slate-900 p-6 rounded-2xl shadow-lg card-hover animate-slideInUp" style={{animationDelay: `${idx*100}ms`}}><h3 className="text-xl font-semibold text-gray-900 dark:text-white mb-3 flex items-start"><i className="fab fa-youtube text-red-500 mr-3 mt-1"></i><span>{video.title}</span></h3><a href={video.link} target="_blank" rel="noopener noreferrer" className="inline-block gradient-button text-white font-bold py-2 px-4 rounded-full shadow-md text-sm">Watch Video <i className="fas fa-play-circle ml-2"></i></a></div>))}</div></div></section> );
    const NoticeSection = ({ onAcknowledgeNotice }) => { useEffect(() => { onAcknowledgeNotice(); }, []); const typeColors = { Announcement: "border-blue-500", Update: "border-green-500", Important: "border-red-500" }; const typeIcons = { Announcement: "fas fa-bullhorn text-blue-500", Update: "fas fa-info-circle text-green-500", Important: "fas fa-exclamation-triangle text-red-500" }; return ( <section id="notices" className="py-12 px-4 md:px-8 bg-gray-50 dark:bg-slate-800"><div className="container mx-auto"><h2 className="text-4xl font-extrabold text-center text-red-500 dark:text-red-400 mb-10 animate-fadeIn">Portal Notices</h2><div className="space-y-6 max-w-4xl mx-auto">{DATA.notices.filter(n => !n.isCompulsory).map((notice, index) => (<div key={notice.id} className={`bg-white dark:bg-slate-900 p-6 rounded-2xl shadow-lg border-l-4 card-hover animate-slideInUp ${typeColors[notice.type] || 'border-gray-500'}`} style={{ animationDelay: `${index * 100}ms` }}><div className="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-2"><div className="flex items-center gap-3"><i className={`${typeIcons[notice.type] || 'fas fa-info-circle'} text-xl`}></i><h3 className="text-xl font-bold">{notice.title}</h3></div><p className="text-sm font-semibold text-gray-500 dark:text-gray-400 mt-2 sm:mt-0">{notice.date}</p></div><p className="mt-2 text-base leading-relaxed text-gray-600 dark:text-gray-300" dangerouslySetInnerHTML={{__html: notice.content}}></p></div>))}</div></div></section> ); };
    const FAQsSection = () => { const [open, setOpen] = useState(null); const [searchTerm, setSearchTerm] = useState(''); const filteredFaqs = useMemo(() => { if (!searchTerm.trim()) return DATA.faqs; const lowercasedFilter = searchTerm.toLowerCase(); return DATA.faqs.map(category => ({ ...category, items: category.items.filter(item => { const questionMatches = item.question.toLowerCase().includes(lowercasedFilter); let answerMatches = false; if (typeof item.answer === 'string') { answerMatches = item.answer.toLowerCase().includes(lowercasedFilter); } return questionMatches || answerMatches; }) })).filter(category => category.items.length > 0); }, [searchTerm]); return ( <section id="faqs" className="py-12 px-4 md:px-8 bg-gray-50 dark:bg-slate-800"><div className="container mx-auto"><h2 className="text-4xl font-extrabold text-center text-red-500 dark:text-red-400 mb-10 animate-fadeIn">Frequently Asked Questions</h2><div className="max-w-4xl mx-auto mb-8 relative"><i className="fas fa-search absolute left-5 top-1/2 -translate-y-1/2 text-gray-400"></i><input type="text" placeholder="Search for a question..." value={searchTerm} onChange={e => setSearchTerm(e.target.value)} className="w-full pl-12 pr-4 py-3 rounded-full border-2 border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-900 focus:ring-2 focus:ring-indigo-500 focus:outline-none transition" /></div>{filteredFaqs.length > 0 ? filteredFaqs.map((cat, ci) => (<div key={ci} className="mb-8 max-w-4xl mx-auto"><h3 className="text-3xl font-bold text-indigo-700 dark:text-indigo-300 mb-6 border-b-2 border-indigo-200 dark:border-indigo-800 pb-2">{cat.category}</h3><div className="space-y-4">{cat.items.map((f, fi) => (<div key={fi} className="bg-white dark:bg-slate-900 rounded-2xl shadow-lg card-hover"><button className="flex justify-between items-center w-full text-left text-lg font-semibold text-gray-900 dark:text-white p-6" onClick={() => setOpen(open === `${ci}-${fi}` ? null : `${ci}-${fi}`)}><span>{f.question}</span><i className={`fas ${open === `${ci}-${fi}` ? 'fa-chevron-up' : 'fa-chevron-down'} text-indigo-500 transition-transform duration-300`}></i></button>{open === `${ci}-${fi}` && (<div className="px-6 pb-6 text-gray-700 dark:text-gray-300 leading-relaxed animate-fadeIn">{f.answer}</div>)}</div>))}</div></div>)) : (<div className="text-center py-10 max-w-4xl mx-auto"><p className="text-xl font-semibold text-gray-700 dark:text-gray-300">No questions found matching your search.</p><p className="text-gray-500 mt-2">Please try a different keyword.</p></div>)}</div></section> ); };
const PremiumCertificate = ({ userName, onDownload, onClose }) => { const date = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }); const portalLogo = "https://raw.githubusercontent.com/ganeshdahal-HUE/practicece/6684a6cfa40eda8be7402689857a23575f0b723a/494645815_122099085086862980_1698079942897814974_n.jpg"; const handleDownload = () => { setTimeout(() => { const element = document.getElementById('premium-certificate'); if (element) { html2canvas(element, { scale: 2, useCORS: true }).then(canvas => { const link = document.createElement('a'); link.download = `Premium_Certificate_${userName}.png`; link.href = canvas.toDataURL(); document.body.appendChild(link); link.click(); document.body.removeChild(link); }); } }, 500); }; return ( <div className="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 p-2" onClick={onClose}> <div className="bg-white rounded-xl max-w-full w-full mx-2 h-[90vh] overflow-y-auto" onClick={(e) => e.stopPropagation()}> <div className="flex justify-between items-center p-3 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-t-xl sticky top-0 z-10"> <h3 className="text-base font-bold">ðŸ‘‘ Premium Certificate</h3> <button onClick={onClose} className="bg-white text-purple-600 rounded-full w-7 h-7 flex items-center justify-center font-bold">Ã—</button> </div> <div className="p-3 bg-gradient-to-br from-purple-50 to-blue-50"> <div id="premium-certificate" className="bg-gradient-to-br from-purple-100 via-white to-blue-100 border-4 border-purple-400 rounded-lg p-4 shadow-2xl min-h-[400px] relative"> <div className="absolute top-2 right-2 text-yellow-500 text-lg">â­</div> <div className="absolute bottom-2 left-2 text-yellow-500 text-lg">ðŸ’Ž</div> <div className="text-center"> <div className="mb-4"> <div className="relative inline-block"> <img src={portalLogo} alt="Logo" className="h-16 w-16 rounded-full border-4 border-yellow-400 mx-auto mb-2 shadow-lg"/> <div className="absolute -top-1 -right-1 bg-yellow-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs">ðŸ‘‘</div> </div> <h1 className="text-xl font-bold text-purple-800">BALEN SCHOLARSHIP</h1> <p className="text-purple-600 font-semibold text-sm">PREMIUM MEMBER</p> </div> <div className="my-4 border-y-2 border-purple-300 py-3 bg-white/50 rounded"> <h2 className="text-2xl font-bold text-purple-900">PREMIUM CERTIFICATE</h2> <p className="text-purple-700 font-semibold text-sm">Exclusive Membership</p> </div> <div className="my-4"> <p className="text-purple-600 mb-3">This prestigious certificate awards</p> <h3 className="text-2xl font-bold bg-gradient-to-r from-purple-600 to-blue-600 text-white py-3 px-6 rounded-lg mb-3 shadow-lg border-2 border-white/50">{userName}</h3> <div className="w-32 h-1 bg-gradient-to-r from-purple-500 to-blue-500 mx-auto mb-3 rounded-full"></div> </div> <div className="max-w-full mx-auto mb-4 bg-white/70 p-3 rounded-lg"> <p className="text-purple-700 text-sm">with <strong>Full Premium Access</strong> to all exclusive resources, unlimited quizzes, and premium features of the Balen Scholarship Portal.</p> </div> <div className="mt-6 pt-4 border-t border-purple-300"> <div className="flex justify-between"> <div className="text-center"> <div className="w-24 h-1 bg-purple-600 mx-auto mb-1 rounded-full"></div> <p className="font-bold text-purple-800 text-sm">Ganesh Dahal</p> <p className="text-xs text-purple-600">Ganesh Dahal (Chairman)</p> </div> <div className="text-center"> <div className="w-24 h-1 bg-purple-600 mx-auto mb-1 rounded-full"></div> <p className="font-bold text-purple-800 text-sm">{date}</p> <p className="text-xs text-purple-600">Membership Date</p> </div> </div> </div> <div className="mt-4 p-2 bg-yellow-100 border border-yellow-300 rounded"> <p className="text-xs text-yellow-800 text-center">ðŸ”’ Lifetime Premium Access â€¢ ðŸ“š Unlimited Resources â€¢ ðŸŽ¯ Priority Support</p> </div> </div> </div> </div> <div className="p-3 bg-gradient-to-r from-purple-500 to-blue-500 sticky bottom-0"> <div className="flex flex-col gap-2"> <button onClick={handleDownload} className="bg-gradient-to-r from-yellow-500 to-yellow-600 hover:from-yellow-600 hover:to-yellow-700 text-white font-bold py-3 px-4 rounded-lg flex items-center justify-center gap-2 shadow-lg"> <i className="fas fa-crown"></i> DOWNLOAD PREMIUM CERTIFICATE </button> <button onClick={onClose} className="bg-white/20 hover:bg-white/30 text-white font-bold py-3 px-4 rounded-lg border border-white/30"> CLOSE </button> </div> </div> </div> </div> ); };
const CompletionCertificate = ({ userName, onDownload, onClose }) => { const date = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }); const portalLogo = "https://raw.githubusercontent.com/ganeshdahal-HUE/practicece/6684a6cfa40eda8be7402689857a23575f0b723a/494645815_122099085086862980_1698079942897814974_n.jpg"; const handleDownload = () => { setTimeout(() => { const element = document.getElementById('completion-certificate'); if (element) { html2canvas(element, { scale: 2, useCORS: true }).then(canvas => { const link = document.createElement('a'); link.download = `Certificate_${userName}.png`; link.href = canvas.toDataURL(); document.body.appendChild(link); link.click(); document.body.removeChild(link); }); } }, 500); }; return ( <div className="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 p-2" onClick={onClose}> <div className="bg-white rounded-xl max-w-full w-full mx-2 h-[90vh] overflow-y-auto" onClick={(e) => e.stopPropagation()}> <div className="flex justify-between items-center p-3 bg-amber-500 text-white rounded-t-xl sticky top-0 z-10"> <h3 className="text-base font-bold">ðŸŽ“ Certificate</h3> <button onClick={onClose} className="bg-white text-amber-600 rounded-full w-7 h-7 flex items-center justify-center font-bold">Ã—</button> </div> <div className="p-3 bg-gray-50"> <div id="completion-certificate" className="bg-white border-4 border-amber-300 rounded-lg p-4 shadow-lg min-h-[400px]"> <div className="text-center"> <div className="mb-4"> <img src={portalLogo} alt="Logo" className="h-14 w-14 rounded-full border-4 border-amber-300 mx-auto mb-2"/> <h1 className="text-xl font-bold text-amber-800">BALEN SCHOLARSHIP</h1> <p className="text-amber-600 font-semibold text-sm">Preparatory Program</p> </div> <div className="my-4 border-y-2 border-amber-200 py-3"> <h2 className="text-2xl font-bold text-amber-900">CERTIFICATE OF COMPLETION</h2> </div> <div className="my-4"> <p className="text-gray-600 mb-3">This is to certify that</p> <h3 className="text-2xl font-bold text-amber-800 mb-3">{userName}</h3> <div className="w-32 h-1 bg-amber-500 mx-auto mb-3"></div> </div> <div className="max-w-full mx-auto mb-4"> <p className="text-gray-700 text-sm">has successfully completed the <strong>Balen Scholarship Preparatory Program</strong> with excellent dedication and academic performance.</p> </div> <div className="mt-6 pt-4 border-t border-amber-200"> <div className="flex justify-between"> <div className="text-center"> <div className="w-24 h-1 bg-amber-600 mx-auto mb-1"></div> <p className="font-bold text-amber-800 text-sm">Ganesh Dahal</p> <p className="text-xs text-gray-600">Ganesh Dahal (Chairman)</p> </div> <div className="text-center"> <div className="w-24 h-1 bg-amber-600 mx-auto mb-1"></div> <p className="font-bold text-amber-800 text-sm">{date}</p> <p className="text-xs text-gray-600">Date</p> </div> </div> </div> </div> </div> </div> <div className="p-3 bg-white border-t sticky bottom-0"> <div className="flex flex-col gap-2"> <button onClick={handleDownload} className="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-lg flex items-center justify-center gap-2"> <i className="fas fa-download"></i> DOWNLOAD CERTIFICATE </button> <button onClick={onClose} className="bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-4 rounded-lg"> CLOSE </button> </div> </div> </div> </div> ); };


   
    
    // =================================================================================
    // ===== MAIN APP COMPONENT =====
    // =================================================================================
    const App = () => {
        const [isLoading, setIsLoading] = useState(true);
        const [isNameSet, setIsNameSet] = useState(false);
        const [activeSection, setActiveSection] = useState('home');
        const [userName, setUserName] = useState('');
        const [isPremium, setIsPremium] = useState(false);
        const [userStats, setUserStats] = useState({ xp: 0, streak: 0, freezes: 1, name: '' });
        const [completedQuizzes, setCompletedQuizzes] = useState({});
        const [unlockedAchievements, setUnlockedAchievements] = useState({});
        const [activityLog, setActivityLog] = useState([]);
        const [toastQueue, setToastQueue] = useState([]);
        const [showPremiumCertModal, setShowPremiumCertModal] = useState(false);
        const [showCompletionCertModal, setShowCompletionCertModal] = useState(false);
        const [showCelebrationModal, setShowCelebrationModal] = useState(false);
        const [hasNewNotice, setHasNewNotice] = useState(false);
        const [compulsoryNotice, setCompulsoryNotice] = useState(null);
        const [forceRefresh, setForceRefresh] = useState(0);
        const [showProfile, setShowProfile] = useState(false);

        const logActivity = (message) => { const log = getJSONFromLocalStorage('activityLog', []); log.unshift(message); const newLog = log.slice(0, 5); localStorage.setItem('activityLog', JSON.stringify(newLog)); setActivityLog(newLog); };
        const checkAndUnlockAchievement = (achievementId) => {
            const currentAchievements = getJSONFromLocalStorage('unlockedAchievements', {});
            if (!currentAchievements[achievementId]) {
                const achievement = DATA.achievementsList[achievementId];
                const newAchievements = { ...currentAchievements, [achievementId]: true };
                setUnlockedAchievements(newAchievements);
                localStorage.setItem('unlockedAchievements', JSON.stringify(newAchievements));
                setToastQueue(prev => [...prev, achievement]);
                logActivity(`Unlocked: '${achievement.title}'`);
            }
        };

       useEffect(() => {
            const storedName = localStorage.getItem('balenUserName');
            if(storedName) {
                setUserName(storedName); setIsNameSet(true); setIsPremium(localStorage.getItem('balenPremiumUnlocked') === 'true');
                setUserStats(getJSONFromLocalStorage('balenUserStats', { xp: 0, streak: 0, freezes: 1, name: storedName }));
                setCompletedQuizzes(getJSONFromLocalStorage('balenCompletedQuizzes', {}));
                setUnlockedAchievements(getJSONFromLocalStorage('unlockedAchievements', {}));
                setActivityLog(getJSONFromLocalStorage('activityLog', []));
                
                const latestNormalNotice = DATA.notices.find(n => !n.isCompulsory);
                const lastSeenNoticeId = getJSONFromLocalStorage('lastSeenNoticeId', 0);
                if (latestNormalNotice && latestNormalNotice.id > lastSeenNoticeId) { setHasNewNotice(true); }

                const latestCompulsory = DATA.notices.find(n => n.isCompulsory);
                const acknowledgedId = getJSONFromLocalStorage('acknowledgedCompulsoryNoticeId', 0);
                if (latestCompulsory && latestCompulsory.id > acknowledgedId) { setCompulsoryNotice(latestCompulsory); }

                const today = new Date().toDateString();
                const lastLogin = localStorage.getItem('balenLastLogin');
                if (lastLogin !== today) {
                    const yesterday = new Date(); yesterday.setDate(yesterday.getDate() - 1);
                    setUserStats(prev => {
                        let newStreak = (lastLogin === yesterday.toDateString()) ? prev.streak + 1 : 1;
                        const newStats = { ...prev, streak: newStreak };
                        localStorage.setItem('balenUserStats', JSON.stringify(newStats));
                        if (newStreak >= 7) checkAndUnlockAchievement('STREAK_7');
                        let unlockedByStreak = 0; for (const day in DATA.STREAK_UNLOCKS) { if (newStreak >= parseInt(day, 10)) { unlockedByStreak = Math.max(unlockedByStreak, DATA.STREAK_UNLOCKS[day]); } }
                        const currentUnlocks = getJSONFromLocalStorage('balenQuizUnlocks', {});
                        localStorage.setItem('balenQuizUnlocks', JSON.stringify({...currentUnlocks, unlockedByStreak, dailyUnlocks: 0}));
                        return newStats;
                    });
                    localStorage.setItem('balenLastLogin', today);
                }
            }
            setTimeout(() => setIsLoading(false), 1500);
        }, [isNameSet, forceRefresh]);

        const handleNameSet = (name) => {
            localStorage.clear();
            localStorage.setItem('balenUserName', name);
            const initialStats = { xp: 0, streak: 1, freezes: 1, name: name };
            localStorage.setItem('balenUserStats', JSON.stringify(initialStats));
            localStorage.setItem('balenLastLogin', new Date().toDateString());
            setUserName(name); setUserStats(initialStats); setIsNameSet(true);
        };
        
        const handlePremiumUnlock = () => { setIsPremium(true); localStorage.setItem('balenPremiumUnlocked', 'true'); checkAndUnlockAchievement('PREMIUM_USER'); setShowPremiumCertModal(true); logActivity('Unlocked Premium Access!'); };
        const handleQuizComplete = (quizDay) => { const currentCompleted = getJSONFromLocalStorage('balenCompletedQuizzes', {}); if (currentCompleted[quizDay]) return; const newCompleted = { ...currentCompleted, [quizDay]: true }; const quizTitle = DATA.dailyQuizzes.find(q=>q.day === quizDay)?.title || `Quiz ${quizDay}`; logActivity(`Completed: '${quizTitle}'`); setCompletedQuizzes(newCompleted); localStorage.setItem('balenCompletedQuizzes', JSON.stringify(newCompleted)); setUserStats(prev => { const xpBonus = prev.streak >= 5 ? DATA.XP_PER_QUIZ : 0; const newStats = { ...prev, xp: prev.xp + DATA.XP_PER_QUIZ + xpBonus }; localStorage.setItem('balenUserStats', JSON.stringify(newStats)); return newStats; }); const completedCount = Object.keys(newCompleted).length; if (completedCount === 1) checkAndUnlockAchievement('FIRST_QUIZ'); if (completedCount === DATA.dailyQuizzes.length) { checkAndUnlockAchievement('ALL_QUIZZES'); setShowCelebrationModal(true); } setForceRefresh(c=>c+1); };
        const handleBrainBreakComplete = () => { setUserStats(prev => { const newStats = { ...prev, xp: prev.xp + DATA.XP_PER_BRAIN_BREAK }; localStorage.setItem('balenUserStats', JSON.stringify(newStats)); return newStats; }); };
        const handleDownloadCertificate = (id) => { const element = document.getElementById(id); if(element) { html2canvas(element, {backgroundColor: '#1e293b', useCORS: true}).then(canvas => { const link = document.createElement('a'); link.download = `${id}_${userName}.png`; link.href = canvas.toDataURL('image/png'); link.click(); }); } setShowPremiumCertModal(false); setShowCompletionCertModal(false); };

        const handleLogoClick = () => {
            setShowProfile(true);
        };

        const renderSection = () => {
            if (showProfile) {
                return (
                    <ProfileSection 
                        userStats={userStats}
                        completedQuizzes={completedQuizzes}
                        unlockedAchievements={unlockedAchievements}
                        onClose={() => setShowProfile(false)}
                    />
                );
            }

            switch(activeSection) {
                case 'home': return <HomeDashboard setActiveSection={setActiveSection} userName={userName} completedQuizzes={completedQuizzes} userStats={userStats} isPremium={isPremium} activityLog={activityLog} />;
                case 'quizzes': return <QuizzesSection isPremium={isPremium} completedQuizzes={completedQuizzes} userStats={userStats} onQuizComplete={handleQuizComplete} onPremiumUnlock={handlePremiumUnlock} onStateRefresh={() => setForceRefresh(c=>c+1)} checkAndUnlockAchievement={checkAndUnlockAchievement} />;
                case 'competition': return <QuizCompetitionSection isPremium={isPremium} onSetUserName={(name) => {if (name) { setUserName(name); localStorage.setItem('balenUserName', name); setUserStats(s => ({...s, name}));}}} unlockedAchievements={unlockedAchievements} checkAndUnlockAchievement={checkAndUnlockAchievement} onShowPremiumCert={() => setShowPremiumCertModal(true)} onShowCompletionCert={() => setShowCompletionCertModal(true)} userStats={userStats} />;
                case 'resources': return <ResourcesSection isPremium={isPremium} onPremiumUnlock={handlePremiumUnlock} userName={userName} checkAndUnlockAchievement={checkAndUnlockAchievement} />;
                case 'entertainment': return <EntertainmentSection onBrainBreakComplete={handleBrainBreakComplete} checkAndUnlockAchievement={checkAndUnlockAchievement} />;
                case 'videos': return <VideosSection />;
                case 'notices': return <NoticeSection onAcknowledgeNotice={() => {setHasNewNotice(false); const latestNormal = DATA.notices.find(n => !n.isCompulsory); if(latestNormal) localStorage.setItem('lastSeenNoticeId', latestNormal.id);}} />;
                case 'faqs': return <FAQsSection />;
                default: return <HomeDashboard setActiveSection={setActiveSection} userName={userName} completedQuizzes={completedQuizzes} userStats={userStats} isPremium={isPremium} activityLog={activityLog} />;
            }
        };

        if (isLoading) return <AppLoader />;
        if (!isNameSet) return <NameEntryScreen onNameSet={handleNameSet} />;

        return (
            <Fragment>
                {compulsoryNotice && <CompulsoryNoticeModal notice={compulsoryNotice} onClose={() => { setCompulsoryNotice(null); localStorage.setItem('acknowledgedCompulsoryNoticeId', compulsoryNotice.id); }} />}
                {showPremiumCertModal && <PremiumCertificate userName={userName} onDownload={() => handleDownloadCertificate('certificate')} />}
                {showCelebrationModal && <CourseCompletionCelebration userName={userName} onViewCertificate={() => { setShowCelebrationModal(false); setShowCompletionCertModal(true); }} />}
                {showCompletionCertModal && <CompletionCertificate userName={userName} onDownload={() => handleDownloadCertificate('completion-certificate')} />}
                <Header setActiveSection={setActiveSection} activeSection={activeSection} isPremium={isPremium} userStats={userStats} hasNewNotice={hasNewNotice} onLogoClick={handleLogoClick} />
                <main>{renderSection()}</main>
                <Footer />
                {toastQueue[0] && <AchievementToast achievement={toastQueue[0]} onDismiss={() => setToastQueue(q => q.slice(1))} />}
            </Fragment>
        );
    };

    ReactDOM.render(<App />, document.getElementById('root'));
</script>
</body>
</html>
